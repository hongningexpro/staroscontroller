<?xml version="1.0" encoding="UTF-8"?>
<starlang xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
	<!--wangkang 2017/09/13 -->
	<class name="CTunnel">
		<private>
			<long name="m_id"/>
			<string name="m_username"/>
			<string name="m_inputPort"/>
			<string name="m_outputPort"/>
			
			<long name="m_serviceinvlan"/>			
			<long name="m_serviceoutvlan"/>
			<string name="m_type"/>
			<string name="m_state"/>
			<long name="m_inputvlanid"/>
			<long name="m_outputvlanid"/>
			
			<!-- wangkang 2017/10/27 -->	
			<string name="m_inputtunnelport"/>
			<string name="m_outputtunnelport"/>
			<long name="m_vxlantunnelid"/>
			<!-- wangkang 2017/11/13 -->
			<string name="m_inputvxlanport"/>
			<string name="m_outputvxlanport"/>
			
			<long name="m_bandwidth"/>
			<object name="m_tunneldevicemgr"/>
			<boolean name="m_bisActive" value="false"/>
			
			<string name="m_fromdevice"/>
			<string name="m_fromdeviceport"/>
			<string name="m_fromtunnelport"/>
			<string name="m_fromvxlanport"/>
			<string name="m_todevice"/>
			<string name="m_todeviceport"/>
			<string name="m_totunnelport"/>
			<string name="m_tovxlanport"/>
		</private>
		<public>
			<function name="CTunnel">
				<parameters>
					<long name="id"/>
					<string name="username"/>
					<string name="inputPort"/>
					<string name="outputPort"/>
					<long name="invlan"/>
					
					<long name="outvlan"/>
					<string name="type"/>
					<string name="state"/>
					<long name="inputvlanid"/>
					<long name="outputvlanid"/>
					
					<!-- wangkang 2017/10/27 -->
					<string name="inputtunnelport"/>
					<string name="outputtunnelport"/>
					<long name="vxlantunnelid"/>
					<!-- wangkang 2017/11/13 -->
					<string name="inputvxlanport"/>
					<string name="outputvxlanport"/>	
					<long name="bandwidth"/>
				</parameters>
				<set name="thisclass.m_id" value="context.id.toLong()"/>
				<set name="thisclass.m_username" value="context.username.toString()"/>
				<set name="thisclass.m_inputPort" value="context.inputPort.toString()"/>
				<set name="thisclass.m_outputPort" value="context.outputPort.toString()"/>
				<set name="thisclass.m_serviceinvlan" value="context.invlan.toLong()"/>
				<set name="thisclass.m_serviceoutvlan" value="context.outvlan.toLong()"/>
				<set name="thisclass.m_type" value="context.type.toString()"/>
				<set name="thisclass.m_state" value="context.state.toString()"/>
				<set name="thisclass.m_inputvlanid" value="context.inputvlanid.toLong()"/>
				<set name="thisclass.m_outputvlanid" value="context.outputvlanid.toLong()"/>
				<set name="thisclass.m_inputtunnelport" value="context.inputtunnelport.toString()"/>
				<set name="thisclass.m_outputtunnelport" value="context.outputtunnelport.toString()"/>
				<set name="thisclass.m_vxlantunnelid" value="context.vxlantunnelid.toLong()"/>	
				<set name="thisclass.m_inputvxlanport" value="context.inputvxlanport.toString()"/>
				<set name="thisclass.m_outputvxlanport" value="context.outputvxlanport.toString()"/>
				<set name="thisclass.m_bandwidth" value="context.bandwidth.toLong()"/>
				<new name="m_tunneldevicemgr" class="CTunnelDeviceManager"/>
				<script><![CDATA[
					var inputport = thisclass.m_inputPort.toString();
					var oneinputid = (inputport.split("/")[0]).split(":")[1];	
					var inputport = inputport.split("/")[1];
					var inputtunnelport = thisclass.m_inputtunnelport.toString();	
					var inputtunnelport = inputtunnelport.split("/")[1];
					var outputtunnelport = thisclass.m_outputtunnelport.toString();	
					var outputtunnelport = outputtunnelport.split("/")[1];	
					var inputvxlanport = thisclass.m_inputvxlanport.toString();	
					var inputvxlanport = inputvxlanport.split("/")[1];
					var outputvxlanport = thisclass.m_outputvxlanport.toString();	
					var outputvxlanport = outputvxlanport.split("/")[1];				
					var outputport = thisclass.m_outputPort.toString();
					var oneoutputid = (outputport.split("/")[0]).split(":")[1];
					var outputport = outputport.split("/")[1];
					thisclass.m_fromdevice.setValue(oneinputid);
					thisclass.m_todevice.setValue(oneoutputid);
					thisclass.m_fromdeviceport.setValue(inputport);
					thisclass.m_todeviceport.setValue(outputport);
					thisclass.m_fromtunnelport.setValue(inputtunnelport);
					thisclass.m_totunnelport.setValue(outputtunnelport);
					thisclass.m_fromvxlanport.setValue(inputvxlanport);
					thisclass.m_tovxlanport.setValue(outputvxlanport);
				]]></script>
			</function>

			<function name="GetTunnelId">
				<parameters>
					<long name="outid"/>
				</parameters>
				<set name="outid" value="thisclass.m_id.toLong()"/>
			</function>
			<!--qiulei 20170913 pm-->
			<function name="GetTunnel_username">
				<parameters>
					<string name="t_username"/>
				</parameters>
				<set name="t_username" value="thisclass.m_username.toString()"/>
			</function>
			
			<function name="GetTunnel_inputPort">
				<parameters>
					<string name="t_inputPort"/>
				</parameters>
				<set name="t_inputPort" value="thisclass.m_inputPort.toString()"/>
			</function>
			
			
			<function name="GetTunne_outputPort">
				<parameters>
					<string name="t_outputPort"/>
				</parameters>
				<set name="t_outputPort" value="thisclass.m_outputPort.toString()"/>
			</function>
			
			<!-- wangkang 2017/10/27 -->
			<function name="GetTunnel_inputtunnelPort">
				<parameters>
					<string name="t_inputtunnelPort"/>
				</parameters>
				<set name="t_inputtunnelPort" value="thisclass.m_inputtunnelPort.toString()"/>
			</function>
					
			<function name="GetTunne_outputtunnelPort">
				<parameters>
					<string name="t_outputtunnelPort"/>
				</parameters>
				<set name="t_outputtunnelPort" value="thisclass.m_outputtunnelPort.toString()"/>
			</function>
			
			<function name="GetVxlanTunnelId">
				<parameters>
					<long name="vxlantunnelid"/>
				</parameters>
				<set name="vxlantunnelid" value="thisclass.m_vxlantunnelid.toLong()"/>
			</function>
			
			<function name="GetTunne_invlan">
				<parameters>
					<long name="t_invlan"/>
				</parameters>
				<set name="t_invlan" value="thisclass.m_invlan.toLong()"/>
			</function>
			
			<function name="GetTunnel_outvlan">
				<parameters>
					<long name="t_outvlan"/>
				</parameters>
				<set name="t_outvlan" value="thisclass.m_outvlan.toLong()"/>
			</function>
			
			<function name="GetTunnel_type">
				<parameters>
					<string name="t_type"/>
				</parameters>
				<set name="t_type" value="thisclass.m_type.toString()"/>
			</function>
			
			<function name="GetTunnel_state">
				<parameters>
					<string name="t_state"/>
				</parameters>
				<set name="t_state" value="thisclass.m_state.toString()"/>
			</function>
			
			<function name="GetTunnel_inputvlanid">
				<parameters>
					<long name="t_inputvlanid"/>
				</parameters>
				<set name="t_inputvlanid" value="thisclass.m_inputvlanid.toLong()"/>
			</function>
			
			<function name="GetTunnel_outputvlanid">
				<parameters>
					<long name="t_outputvlanid"/>
				</parameters>
				<set name="t_outputvlanid" value="thisclass.m_outputvlanid.toLong()"/>
			</function>
			
			<function name="GetTunnel_bandwidth">
				<parameters>
					<long name="t_bandwidth"/>
				</parameters>
				<set name="t_bandwidth" value="thisclass.m_bandwidth.toLong()"/>
			</function>
			
			<!--qiulei 20170913-->

			<function name="OneTunnelObjectToJsonString">
				<parameters>
					<string name="TunnelObjectToJson"/>
				</parameters>
				<log>insert CTunnel OneTunnelObjectToJsonString</log>
				<string name="values"/>
				<reference variable="values">
					<jsonbody><![CDATA[ 
						{	
							"id":"<%=thisclass.m_id.toString()%>",
							"username":"<%=thisclass.m_username.toString()%>",
							"inputPort":"<%=thisclass.m_inputPort.toString()%>",
							"outputPort":"<%=thisclass.m_outputPort.toString()%>",
							"invlan":"<%=thisclass.m_serviceinvlan.toString()%>",
							
							"outvlan":"<%=thisclass.m_serviceoutvlan.toString()%>",
							"type":"<%=thisclass.m_type.toString()%>",
							"state":"<%=thisclass.m_state.toString()%>",
							"inputvlanid":"<%=thisclass.m_inputvlanid.toString()%>",
							"outputvlanid":"<%=thisclass.m_outputvlanid.toString()%>",
							
							"inputtunnelPort":"<%=thisclass.m_inputtunnelport.toString()%>",
							"outputtunnelPort":"<%=thisclass.m_outputtunnelport.toString()%>",
							"vxlantunnelid":"<%=thisclass.m_vxlantunnelid.toLong().toString()%>",
							"inputvxlanPort":"<%=thisclass.m_inputvxlanport.toString()%>",
							"outputvxlanPort":"<%=thisclass.m_outputvxlanport.toString()%>",
							"bandwidth":"<%=thisclass.m_bandwidth.toString()%>"
						}
					]]></jsonbody>
				</reference>
				<log><![CDATA[context.values = <%=context.values.toString()%>]]></log>
				<set name="TunnelObjectToJson" value="context.values.toString()"/>
			</function>
			
			<!--qiulei 20170913 update Tunnel-->
			<function name="UpdateTunnel">
				<parameters>
					<string name="username"/>
					<string name="inputPort"/>
					<string name="outputPort"/>
					<long name="invlan"/>
					
					<long name="outvlan"/>
					<string name="type"/>
					<string name="state"/>
					<long name="inputvlanid"/>
					<long name="outputvlanid"/>
					
					<!-- wangkang 2017/10/27 -->
					<string name="inputtunnelport"/>
					<string name="outputtunnelport"/>
					<!-- wangkang 2017/11/13 -->
					<string name="inputvxlanport"/>
					<string name="outputvxlanport"/>						
					<long name="bandwidth"/>
				</parameters>
				
				<set name="thisclass.m_username" value="context.username.toString()"/>
				<set name="thisclass.m_inputPort" value="context.inputPort.toString()"/>
				<set name="thisclass.m_outputPort" value="context.outputPort.toString()"/>
				<set name="thisclass.m_serviceinvlan" value="context.invlan.toLong()"/>
				<set name="thisclass.m_serviceoutvlan" value="context.outvlan.toLong()"/>
				<set name="thisclass.m_type" value="context.type.toString()"/>
				<set name="thisclass.m_state" value="context.state.toString()"/>
				<set name="thisclass.m_inputvlanid" value="context.inputvlanid.toLong()"/>
				<set name="thisclass.m_outputvlanid" value="context.outputvlanid.toLong()"/>
				<set name="thisclass.m_inputtunnelport" value="context.inputtunnelport.toString()"/>
				<set name="thisclass.m_outputtunnelport" value="context.outputtunnelport.toString()"/>			
				<set name="thisclass.m_inputvxlanport" value="context.inputvxlanport.toString()"/>
				<set name="thisclass.m_outputvxlanport" value="context.outputvxlanport.toString()"/>	
				<set name="thisclass.m_bandwidth" value="context.bandwidth.toLong()"/>
			</function>
			<function name="ActiveTunnel">
				<log>==============================</log>
				<log level="100">##### Active Tunnel #####</log>
				<if cond="thisclass.m_bisActive.toBoolean()==true">
					<then>
						<function>
							<log>Tunnel is Active already</log>
							<exit/>
						</function>
					</then>
				</if>
				<if cond="thisclass.m_type.toString() == 'vxlan'">
					<then>
						<function name="VxlanActiveTunnel"/>
					</then>
					<elseif cond="thisclass.m_type.toString() == 'vlan'">
						<then>
							<function name="VlanActiveTunnel"/>
						</then>
					</elseif>
				</if>
			</function>

			<!-- wangkang 2017/09/15 -->
			<function name="VlanActiveTunnel">
				<object name="firstdevice"/>
				<object name="lastdevice"/>
				<object name="onedevice"/>
				<list name="middevice" valuetype="object"/>
				<list-iterator name="middeviceiterator" valuetype="object"/>
				<list-iterator name="middevicefirst" valuetype="object"/>
				<list-iterator name="middeviceend" valuetype="object"/>
				<boolean name="getpathresult"/>
				<!--
				<function name="InstallMeter"/>
				<function name="InstallFlow"/>
				-->
				<function name="GetShortPath">
					<parameters>
						<boolean name="result" out="context.getpathresult"/>
					</parameters>
				</function>
		
				<if cond="context.getpathresult.toBoolean()==false">
					<then>
						<log>getpathresult is false</log>
						<exit/>
					</then>
				</if>
				
				<if cond="thisclass.m_tunneldevicemgr.ptr!= null">
					<then>
						<function name="PrintTunnerDevice" class="m_tunneldevicemgr"/>
						<log>##### m_tunneldevicemgr is not null #####</log>
						<function name="GetFirstDevice" class="m_tunneldevicemgr">
							<parameters>
								<object name="firstdevice" out="context.firstdevice"/>
							</parameters>
						</function>
						
						<function name="GetLastDevice" class="m_tunneldevicemgr">
							<parameters>
								<object name="lastdevice" out="context.lastdevice"/>
							</parameters>
						</function>
						
						<function name="GetMiddleDevice" class="m_tunneldevicemgr">
							<parameters>
								<list name="devicelist" out="context.middevice"/>
							</parameters>							
						</function>
					</then>
				</if>
	
				<if cond="context.firstdevice.ptr==null">
					<then>
						<log>firstdevice is null</log>
						<exit/>
					</then>
				</if>
				<if cond="context.lastdevice.ptr==null">
					<then>
						<log>lastdevice is null</log>
						<exit/>
					</then>
				</if>
				<if cond="context.firstdevice.equal(context.lastdevice)">
					<then>
						<log>context.firstdevice==context.lastdevice</log>
						<function name="installRuleAtSameDevice" class="firstdevice">
							<parameters>
								<string name="inport" in="thisclass.m_fromdeviceport.toString()"/>
								<string name="invlan" in="thisclass.m_inputvlanid.toString()"/>
								<string name="outport" in="thisclass.m_todeviceport.toString()"/>
								<string name="outvlan" in="thisclass.m_outputvlanid.toString()"/>
								<long name="bandwith" in="thisclass.m_bandwidth.toLong()"/>
							</parameters>
						</function>
						<set name="m_bisActive" value="true"/>
						<exit/>
					</then>
				</if>
				<function name="installRuleStart" class="firstdevice">
					<parameters>
						<string name="inport" in="thisclass.m_fromdeviceport.toString()"/>
						<string name="invlan" in="thisclass.m_inputvlanid.toString()"/>
						<string name="serviceinvlan" in="thisclass.m_serviceinvlan.toString()"/>
						<string name="serviceoutvlan" in="thisclass.m_serviceoutvlan.toString()"/>
						<long name="bandwith" in="thisclass.m_bandwidth.toLong()"/>
					</parameters>
				</function>
				<function name="installRuleEnd" class="lastdevice">
					<parameters>
						<string name="serviceinvlan" in="thisclass.m_serviceinvlan.toString()"/>
						<string name="serviceoutvlan" in="thisclass.m_serviceoutvlan.toString()"/>
						<string name="outport" in="thisclass.m_todeviceport.toString()"/>
						<string name="outvlan" in="thisclass.m_outputvlanid.toString()"/>
						<long name="bandwith" in="thisclass.m_bandwidth.toLong()"/>
					</parameters>
				</function>

				<set name="middevicefirst" value="context.middevice.begin()"/>
				<set name="middeviceend" value="context.middevice.end()"/>				
				<log><![CDATA[middevice size=<%=context.middevice.size().toString()%>]]></log>			
				<for var="context.middeviceiterator" from="context.middevicefirst" to="context.middeviceend">
					<set name="onedevice" value="context.middeviceiterator.value()"/>
					<if cond="context.onedevice.ptr == null">
						<then>
							<log>middevicelist onedevice is null</log>
							<exit/>
						</then>
					</if>
					<function name="installRuleMid" class="onedevice">
						<parameters>
							<string name="serviceinvlan" in="thisclass.m_serviceinvlan.toString()"/>
							<string name="serviceoutvlan" in="thisclass.m_serviceoutvlan.toString()"/>
						</parameters>
					</function>
				</for>
				<set name="m_bisActive" value="true"/>
			</function>
			<function name="DeactiveTunnel">
				<log level="100">##### Deactive Tunnel #####</log>
				<if cond="thisclass.m_bisActive.toBoolean()==false">
					<then>
						<function>
							<log>Tunnel is Deactive already</log>
							<exit/>
						</function>
					</then>
				</if>
				<if cond="thisclass.m_tunneldevicemgr.ptr!= null">
					<then>
						<function name="DeactiveTunnel" class="m_tunneldevicemgr"/>
					</then>
				</if>
				<set name="m_bisActive" value="false"/>
			</function>
			
			<!--wangkang 2017/10/27 -->
			<function name="VxlanActiveTunnel">
				<object name="firstdevice"/>
				<object name="lastdevice"/>
				<boolean name="getpathresult"/>
				<log level="100">### Vxlan Active Tunnel ###</log>
				<function name="GetShortPath">
					<parameters>
						<boolean name="result" out="context.getpathresult"/>
					</parameters>
				</function>
		
				<if cond="context.getpathresult.toBoolean()==false">
					<then>
						<log level="100">getpathresult is false</log>
						<function name="CreateTunnelDevice" class="thisclass.m_tunneldevicemgr">
							<parameters>
								<string name="deviceid" in="thisclass.m_fromdevice.toString()"/>
							</parameters>
						</function>
						<function name="CreateTunnelDevice" class="thisclass.m_tunneldevicemgr">
							<parameters>
								<string name="deviceid" in="thisclass.m_todevice.toString()"/>
							</parameters>
						</function>
						<if cond="thisclass.m_tunneldevicemgr.ptr!= null">
							<then>
								<function name="PrintTunnerDevice" class="m_tunneldevicemgr"/>
								<log level="100">##### m_tunneldevicemgr is not null #####</log>
								<function name="GetFirstDevice" class="m_tunneldevicemgr">
									<parameters>
										<object name="firstdevice" out="context.firstdevice"/>
									</parameters>
								</function>
								
								<function name="GetLastDevice" class="m_tunneldevicemgr">
									<parameters>
										<object name="lastdevice" out="context.lastdevice"/>
									</parameters>
								</function>
							</then>
						</if>
						<if cond="context.firstdevice.ptr != null">
							<then>
								<function name="InstallVxlanTunnelStart" class="firstdevice">
									<parameters>
										<string name="inport" in="thisclass.m_fromdeviceport.toString()"/>
										<string name="inputtunnelport" in="thisclass.m_inputtunnelport.toString()"/>
										<long name="vxlantunnelid" in="thisclass.m_vxlantunnelid.toLong()"/>
										<long name="bandwith" in="thisclass.m_bandwidth.toLong()"/>
									</parameters>
								</function>
							</then>
						</if>
						<if cond="context.lastdevice.ptr != null">
							<then>
								<function name="InstallVxlanTunnelEnd" class="lastdevice">
									<parameters>
										<string name="outport" in="thisclass.m_todeviceport.toString()"/>
										<string name="outputtunnelport" in="thisclass.m_outputtunnelport.toString()"/>
										<long name="vxlantunnelid" in="thisclass.m_vxlantunnelid.toLong()"/>
										<long name="bandwith" in="thisclass.m_bandwidth.toLong()"/>
									</parameters>
								</function>
							</then>
						</if>
						<set name="m_bisActive" value="true"/>
					</then>
					<elseif cond="context.getpathresult.toBoolean()==true">
						<then>
							<log level="100">getpathresult is true</log>
							<if cond="thisclass.m_tunneldevicemgr.ptr!= null">
								<then>
									<function name="PrintTunnerDevice" class="m_tunneldevicemgr"/>
									<log level="100">##### m_tunneldevicemgr is not null #####</log>
									<function name="GetFirstDevice" class="m_tunneldevicemgr">
										<parameters>
											<object name="firstdevice" out="context.firstdevice"/>
										</parameters>
									</function>
									
									<function name="GetLastDevice" class="m_tunneldevicemgr">
										<parameters>
											<object name="lastdevice" out="context.lastdevice"/>
										</parameters>
									</function>
								</then>
							</if>

							<if cond="context.firstdevice.ptr != null">
								<then>
									<log level="100">firstdevice is not null</log>
									<function name="InstallVxlanZhuanXianStart" class="firstdevice">
										<parameters>
											<string name="inport" in="thisclass.m_fromdeviceport.toString()"/>
										</parameters>
									</function>
								</then>
							</if>
							<if cond="context.lastdevice.ptr != null">
								<then>
									<log level="100">lastdevice is not null</log>
									<function name="InstallVxlanZhuanXianEnd" class="lastdevice">
										<parameters>
											<string name="outport" in="thisclass.m_todeviceport.toString()"/>
										</parameters>
									</function>
								</then>
							</if>
							<set name="m_bisActive" value="true"/>
						</then>
					</elseif>
				</if>
			</function>
			
			<function name="GetShortPath">
				<parameters>
					<boolean name="result"/>
				</parameters>
				<log level="100">##### Get Shortest Path #####</log>
				<string name="strlink"/>
				<string name="strlink2"/>
				<if cond="thisclass.m_fromdevice.toString()==thisclass.m_todevice.toString()">
					<then>
						<function name="CreateTunnelDevice" class="thisclass.m_tunneldevicemgr">
							<parameters>
								<string name="deviceid" in="thisclass.m_fromdevice.toString()"/>
							</parameters>
						</function>
						<set name="result" value="true"/>
					</then>
					<else>
						<function name="getShortestPath" class="TopoService">
							<parameters>
								<string name="fromdevice" in="thisclass.m_fromdevice.toString()"/>
								<string name="todevice" in="thisclass.m_todevice.toString()"/>
								<string name="outjson" out="context.strlink"/>
							</parameters>
						</function>	
						<log level="100"><![CDATA[ShortestPath = <%=context.strlink.toString()%>]]></log>				
						<if cond="context.strlink.toString()!=''">
							<then>
								<function name="GetTunnelDeviceFromJson" class="thisclass.m_tunneldevicemgr">
									<parameters>
										<string name="json" in="context.strlink.toString()"/>
									</parameters>
								</function>
								<log level="100">result true</log>
								<set name="result" value="true"/>
							</then>
							<else>
								<log level="100">result false</log>
								<set name="result" value="false"/>
							</else>
						</if>
					</else>
				</if>
			</function>
			
			<!-- wangkang 2017/09/21-->
			<function name="FindTunnelDeviceFromlist">
				<parameters>
					<string name="json"/>
				</parameters>
				<string name="dstport"/>
				<string name="srcport"/>
				<string name="oneinputport"/>
				<string name="oneoutputport"/>
				<string name="onedeviceid"/>
				<object name="onetunneldevice"/>
				<log><![CDATA[json=<%=context.json.toString()%>]]></log>
				<script><![CDATA[
					if (context.json.toString().length>0)
					{
						var info = JSON.parse(context.json.toString());
						if (info.paths.length==1)
						{
							context.dstport.setValue(info.paths[0].dst.port);
							context.srcport.setValue(info.paths[0].src.port);
						}
					}
				]]></script>
				
				<for var="onetunneldevice" in="thisclass.m_tunneldevicemgr.tunneldeviceContainer">
					<function name="GetInputPort" class="context.onetunneldevice">
						<parameters>
							<string name="inputPort" out="context.oneinputport"/>
						</parameters>
					</function>
					<function name="GetOutputPort" class="context.onetunneldevice">
						<parameters>
							<string name="outputPort" out="context.oneoutputport"/>
						</parameters>
					</function>
					<if cond="context.srcport.toString() == context.inputport.toString()">
						<then>
							<if cond="context.dstport.toString() == context.outputport.toString()">
								<then>
									<log>TunnelDevice is Find From List</log>
									<function name="GetTunnelDeviceId" class="context.onetunneldevice">
										<parameters>
											<string name="outtunneldeviceid" out="context.onedeviceid"/>
										</parameters>
									</function>
									<exit/>
								</then>
							</if>
						</then>
					</if>
				</for>
				<function name="removeTunnelDevice" class="thisclass.m_tunneldevicemgr">
					<parameters>
						<string name="deviceid" in="context.onedeviceid"/>
					</parameters>
				</function>
				<function name="GetShortPath"/>
			</function>
			
			<!--Topology change-->
			<function name="mytopremove">
				<parameters>
					<string name="fromdevice"/>
					<string name="todevice"/>
					<string name="path"/>
				</parameters>
				<boolean name="isChange" value="false"/>
				<log>###### CTunnel mytopremove ######</log>
				<log>Tunnel Top channge</log>
				<log><![CDATA[CTunnel mytopremove fromdevice = <%=context.fromdevice.toString()%>]]></log>
				<function name="IsMyTopChange" class="m_tunneldevicemgr">
					<parameters>
						<string name="fromdevice" in="context.fromdevice.toString()"/>
						<string name="todevice" in="context.todevice.toString()"/>
						<string name="path" in="context.path.toString()"/>
						<boolean name="ischanage" out="context.isChange"/>
					</parameters>
				</function>
				<if cond="context.isChange.toBoolean()==true">
					<then>
						<function name="DeactiveTunnel"/>
						<function name="ActiveTunnel"/>
					</then>					
				</if>
			</function>
			
		</public>
	</class>
</starlang>