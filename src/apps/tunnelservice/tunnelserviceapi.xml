<?xml version="1.0" encoding="UTF-8"?>
<starosxml xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
	<!--
		Author:
				YY
		Date:
				2017-09-14
		Copyright: 
				Nanjing StarOS Inc. All rights reserved.
	-->	
	<function name="RegisterHandler">
		<log>insert tunnelserviceapi RegisterHandler</log>
		
		
		<function name="RegisterAPIHandler" class="restfulservice">
			<parameters>
				<parameter name="bundleid" type="long" in="context.getCurrentBundleId()"/>			
				<parameter name="handleevent" type="string" in="'processactiverequest'"/>
				<parameter name="requestpathtest" type="string" in="'/onos/v1/tunnelservice/tunnels/active'"/>			
			</parameters>
		</function>
		<function name="RegisterAPIHandler" class="restfulservice">
			<parameters>
				<parameter name="bundleid" type="long" in="context.getCurrentBundleId()"/>			
				<parameter name="handleevent" type="string" in="'processdeactiverequest'"/>
				<parameter name="requestpathtest" type="string" in="'/onos/v1/tunnelservice/tunnels/deactive'"/>			
			</parameters>
		</function>
		<function name="RegisterAPIHandler" class="restfulservice">
			<parameters>
				<parameter name="bundleid" type="long" in="context.getCurrentBundleId()"/>			
				<parameter name="handleevent" type="string" in="'processtunnelsrequest'"/>
				<parameter name="requestpathtest" type="string" in="'/onos/v1/tunnelservice/tunnels'"/>			
			</parameters>
		</function>
		<function name="RegisterAPIHandler" class="restfulservice">
			<parameters>
				<parameter name="bundleid" type="long" in="context.getCurrentBundleId()"/>			
				<parameter name="handleevent" type="string" in="'processrequest'"/>
				<parameter name="requestpathtest" type="string" in="'/onos/v1/tunnelservice/tunnel'"/>			
			</parameters>
		</function>
	</function>
	
	<function name="UnRegisterHandler">
		<function name="UnRegisterAPIHandler" class="restfulservice">
			<parameters>
				<parameter name="requestpath" type="string" in="'/onos/v1/tunnelservice/tunnels/active'"/>			
			</parameters>
		</function>
		<function name="UnRegisterAPIHandler" class="restfulservice">
			<parameters>
				<parameter name="requestpath" type="string" in="'/onos/v1/tunnelservice/tunnels/deactive'"/>			
			</parameters>
		</function>
		<function name="UnRegisterAPIHandler" class="restfulservice">
			<parameters>
				<parameter name="requestpath" type="string" in="'/onos/v1/tunnelservice/tunnels'"/>			
			</parameters>
		</function>
		<function name="UnRegisterAPIHandler" class="restfulservice">
			<parameters>
				<parameter name="requestpath" type="string" in="'/onos/v1/tunnelservice/tunnel'"/>			
			</parameters>
		</function>
	</function>
	
	<events>
		<onevent event="processactiverequest">
			<log>tunnelserviceapi processactiverequest</log>
			<variable name="size" type="long"/>
			<function name="getTunnelNum" class="context.tunnelManagerObject">
				<parameters>
					<parameter name="size" type="long" out="context.size"/>
				</parameters>
			</function>
			<if cond="context.size.toLong()==0">
				<then>
					<function name="ErrorDataResponse">
						<parameters>
							<parameter name="resourceid" type="long" in="-1"/>
							<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
							<parameter name="description" type="string" in="'This tunnelcontanier size is null!'"/>
						</parameters>
					</function>
					<exit/>
				</then>
			</if>
			<function name="ActiveTunnel" class="context.tunnelManagerObject"/>
			<variable name="outjson" type="string"/>
			<script><![CDATA[
				var json = new Object();
				var one = new Object();
				one.resourceId = 0;
				one.code = 0;
				one.description = "ok";						
				json.result = one;
				var strjson=JSON.stringify(json);												
				context.outjson.setValue(strjson);
			]]></script>
			<function name="SendResponse" class="RestfulService">
				<parameters>
					<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
					<parameter name="json" type="string" in="context.outjson.toString()"/>
				</parameters>
			</function>
		</onevent>
		<onevent event="processdeactiverequest">
			<log>tunnelserviceapi processdeactiverequest</log>
			<variable name="size" type="long"/>
			<function name="getTunnelNum" class="context.tunnelManagerObject">
				<parameters>
					<parameter name="size" type="long" out="context.size"/>
				</parameters>
			</function>
			<if cond="context.size.toLong()==0">
				<then>
					<function name="ErrorDataResponse">
						<parameters>
							<parameter name="resourceid" type="long" in="-1"/>
							<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
							<parameter name="description" type="string" in="'This tunnelcontanier size is null!'"/>
						</parameters>
					</function>
					<exit/>
				</then>
			</if>
			<function name="DeactiveTunnel" class="context.tunnelManagerObject"/>
			<variable name="outjson" type="string"/>
			<script><![CDATA[
				var json = new Object();
				var one = new Object();
				one.resourceId = 0;
				one.code = 0;
				one.description = "ok";						
				json.result = one;
				var strjson=JSON.stringify(json);												
				context.outjson.setValue(strjson);
			]]></script>
			<function name="SendResponse" class="RestfulService">
				<parameters>
					<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
					<parameter name="json" type="string" in="context.outjson.toString()"/>
				</parameters>
			</function>
		</onevent>
		<onevent event="processtunnelsrequest">
			<log>tunnelserviceapi processtunnelsrequest</log>					
			<function name="getAllTunnels"/>				
		</onevent>
		<onevent event="processrequest">
			<log>tunnelserviceapi processrequest</log>			
			<if cond="event.getParam('method').toString()=='GET'">
				<then>
					<log>insert method get</log>
					<function name="getTunnel"/>
				</then>
				<elseif cond="event.getParam('method').toString()=='PUT'">
					<log>insert method put</log>										
					<function name="updateTunnel"/>
				</elseif>
				<elseif cond="event.getParam('method').toString()=='POST'">
					<log>insert method post</log>	
					<function name="addTunnel"/>
				</elseif>
				<else>
					<log>insert method delete</log>
					<function name="deleteTunnel"/>
				</else>									
			</if>				
		</onevent>
	</events>
	<function name="getAllTunnels">		
		<log>insert getAllTunnels</log>
		<variable name="outjson" type="string"/>
		<function name="AllTunnelToJsonStr" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="AllTunnelJsonString" type="string" out="context.outjson"/>
			</parameters>
		</function>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
				<parameter name="json" type="string" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	<function name="getTunnel">
		<log>insert method == get</log>
		<variable name="resourceid" type="long"/>
		<variable name="tunnel" type="class"/>
		<variable name="outjson" type="string"/>
		<script><![CDATA[
			var str = event.getParam('requestpath').toString();
			var array = str.split("/");
			var local_id = array[array.length-1];
			context.resourceid.setValue(local_id);
		]]></script>		
		<function name="GetOneTunnelObject" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="tunnel_id" type="long" in="context.resourceid.toLong()"/>
				<parameter name="TunnelObject" type="class" out="context.tunnel"/>
			</parameters>
		</function>
		<if cond="context.tunnel==null">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="context.resourceid.toLong()"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This tunnel is null!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="OneTunnelObjectToJsonString" class="context.tunnel">
			<parameters>
				<parameter name="TunnelObjectToJson" type="string" out="context.outjson"/>
			</parameters>
		</function>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
				<parameter name="json" type="string" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	<function name="updateTunnel">		
		<log>insert method == put</log>
		<variable name="resourceid" type="long"/>
		<variable name="tunnel" type="class"/>
		<variable name="outjson" type="string"/>
		<variable name="username" type="string"/>
		<variable name="inputPort" type="string"/>
		<variable name="outputPort" type="string"/>
		<variable name="type" type="string"/>
		<variable name="state" type="string"/>
		<variable name="inputvlanid" type="long"/>
		<variable name="outputvlanid" type="long"/>
		<variable name="bandwidth" type="long"/>		
		<variable name="putindexof" type="long" value="0"/>
		<variable name="inputdevice" type="string" value=""/>
		<variable name="outputdevice" type="string" value=""/>
		<variable name="indevice" type="class"/>
		<variable name="outdevice" type="class"/>
		<variable name="IsAlikePort" type="boolean" value="false"/>
		<variable name="indeviceportobj" type="class"/>
		<variable name="indeivceportnum" type="long"/>
		<variable name="innum" type="long"/>
		<variable name="outdeviceportobj" type="class"/>
		<variable name="outdeivceportnum" type="long"/>
		<variable name="outnum" type="long"/>
		<script><![CDATA[
			var str = event.getParam('requestpath').toString();
			var array = str.split("/");
			var local_id = array[array.length-1];
			context.resourceid.setValue(local_id);
		]]></script>		
		<function name="GetOneTunnelObject" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="tunnel_id" type="long" in="context.resourceid.toLong()"/>
				<parameter name="TunnelObject" type="class" out="context.tunnel"/>
			</parameters>
		</function>
		<script><![CDATA[									
			var json = JSON.parse(event.getParam('eventdata').toString());
			var local_username = json.username;
			var local_inputport = json.inputPort;
			var local_outputPort = json.outputPort;
			var local_type = json.type;
			var local_state = "active";
			var local_inputvlanid = json.inputvlanid;
			var local_outputvlanid = json.outputvlanid;
			var local_bandwidth = json.bandwidth;
			context.username.setValue(local_username);
			context.inputPort.setValue(local_inputport);
			context.outputPort.setValue(local_outputPort);
			context.type.setValue(local_type);
			context.state.setValue(local_state);
			context.inputvlanid.setValue(local_inputvlanid);
			context.outputvlanid.setValue(local_outputvlanid);
			context.bandwidth.setValue(local_bandwidth);
			if (local_inputport == local_outputPort)
			{
				context.IsAlikePort.setValue(true);
			}
			if ((local_inputport.indexOf("of:") != -1) && (local_outputPort.indexOf("of:") != -1))
			{
				context.putindexof.setValue(1);
				if (local_inputport.split(":")[1] != '')
				{
					if (local_inputport.split(":")[1].split("/")[0] != '')
					{
						if (local_inputport.split("/")[1] != '')
						{
							context.innum.setValue(local_inputport.split("/")[1]);
							context.inputdevice.setValue(local_inputport.split(":")[1].split("/")[0]);
						}
					}
				}
				if (local_outputPort.split(":")[1] != '')
				{
					if (local_outputPort.split(":")[1].split("/")[0] != '')
					{
						if (local_outputPort.split("/")[1] != '')
						{
							context.outnum.setValue(local_outputPort.split("/")[1]);
							context.outputdevice.setValue(local_outputPort.split(":")[1].split("/")[0]);
						}						
					}
				}				
			}
		]]></script>
		<if cond="context.IsAlikePort.toBoolean() == true">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'The port data can not alike!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<if cond="context.putindexof.toLong()!=1">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="context.resourceid.toLong()"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'Port is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<if cond="context.inputdevice.toString()=='' || context.outputdevice.toString()==''">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="context.resourceid.toLong()"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'Port is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<parameter name="outdevice" type="class" out="context.indevice"/>
				<parameter name="datapathid" type="string" in="context.inputdevice.toString()"/>
			</parameters>
		</function>		
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<parameter name="outdevice" type="class" out="context.outdevice"/>
				<parameter name="datapathid" type="string" in="context.outputdevice.toString()"/>
			</parameters>
		</function>
		<if cond="context.indevice==null || context.outdevice==null">
			<then>
				<log>indevicde is null or outdevice is null</log>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="context.resourceid.toLong()"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This id is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="GetPortManager" class="context.indevice">
			<parameters>
				<parameter name="outportmgr" type="class" out="context.indeviceportobj"/>
			</parameters>
		</function>
		<function name="GetPortNumberSize" class="context.indeviceportobj">
			<parameters>
				<parameter name="portnumber" type="long" out="context.indeivceportnum"/>
			</parameters>
		</function>
		<if cond="context.innum.toLong() > context.indeivceportnum.toLong()">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="context.resourceid.toLong()"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This portnum is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="GetPortManager" class="context.outdevice">
			<parameters>
				<parameter name="outportmgr" type="class" out="context.outdeviceportobj"/>
			</parameters>
		</function>
		<function name="GetPortNumberSize" class="context.outdeviceportobj">
			<parameters>
				<parameter name="portnumber" type="long" out="context.outdeivceportnum"/>
			</parameters>
		</function>
		<if cond="context.outnum.toLong() > context.outdeivceportnum.toLong()">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="context.resourceid.toLong()"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This portnum is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="UpdateTunnel" class="context.tunnel">
			<parameters>											
				<parameter name="username" type="string" in="context.username.toString()"/>
				<parameter name="inputPort" type="string" in="context.outputPort.toString()"/>
				<parameter name="outputPort" type="string" in="context.outputPort.toString()"/>
				<parameter name="type" type="string" in="context.type.toString()"/>
				<parameter name="state" type="string" in="context.state.toString()"/>
				<parameter name="inputvlanid" type="long" in="context.inputvlanid.toLong()"/>
				<parameter name="outputvlanid" type="long" in="context.outputvlanid.toLong()"/>	
				<parameter name="bandwidth" type="long" in="context.bandwidth.toLong()"/>
			</parameters>
		</function>			
		<script><![CDATA[
			var json = new Object();
			var one = new Object();
			one.resourceId = ""+context.resourceid.toLong();
			one.code = "0";
			one.description = "ok";						
			json.result = one;
			var strjson=JSON.stringify(json);												
			context.outjson.setValue(strjson);
		]]></script>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
				<parameter name="json" type="string" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	<function name="addTunnel">
		<variable name="username" type="string"/>
		<variable name="inputPort" type="string"/>
		<variable name="outputPort" type="string"/>
		<variable name="type" type="string"/>
		<variable name="state" type="string"/>
		<variable name="inputvlanid" type="long"/>
		<variable name="outputvlanid" type="long"/>
		<variable name="bandwidth" type="long"/>
		<variable name="resourceid" type="long"/>
		<variable name="outjson" type="string"/>
		<variable name="tunnel" type="class"/>
		<variable name="inputdevice" type="string" value=""/>
		<variable name="outputdevice" type="string" value=""/>
		<variable name="indevice" type="class"/>
		<variable name="outdevice" type="class"/>
		<variable name="putindexof" type="long" value="0"/>
		<variable name="result" type="boolean"/>
		<variable name="IsAlikePort" type="boolean" value="false"/>
		<variable name="indeviceportobj" type="class"/>
		<variable name="indeivceportnum" type="long"/>
		<variable name="innum" type="long"/>
		<variable name="outdeviceportobj" type="class"/>
		<variable name="outdeivceportnum" type="long"/>
		<variable name="outnum" type="long"/>
		<script><![CDATA[									
			var json = JSON.parse(event.getParam('eventdata').toString());
			var local_username = json.username;
			var local_inputport = json.inputPort;
			var local_outputPort = json.outputPort;
			var local_type = json.type;
			var local_state = "active";
			var local_inputvlanid = json.inputvlanid;
			var local_outputvlanid = json.outputvlanid;
			var local_bandwidth = json.bandwidth;
			context.username.setValue(local_username);
			context.inputPort.setValue(local_inputport);
			context.outputPort.setValue(local_outputPort);
			context.type.setValue(local_type);
			context.state.setValue(local_state);
			context.inputvlanid.setValue(local_inputvlanid);
			context.outputvlanid.setValue(local_outputvlanid);
			context.bandwidth.setValue(local_bandwidth);
			if (local_inputport == local_outputPort)
			{
				context.IsAlikePort.setValue(true);
			}
			if ((local_inputport.indexOf("of:") != -1) && (local_outputPort.indexOf("of:") != -1))
			{
				context.putindexof.setValue(1);
				if (local_inputport.split(":")[1] != '')
				{
					if (local_inputport.split(":")[1].split("/")[0] != '')
					{
						if (local_inputport.split("/")[1] != '')
						{
							context.innum.setValue(local_inputport.split("/")[1]);
							context.inputdevice.setValue(local_inputport.split(":")[1].split("/")[0]);
						}
					}
				}
				if (local_outputPort.split(":")[1] != '')
				{
					if (local_outputPort.split(":")[1].split("/")[0] != '')
					{
						if (local_outputPort.split("/")[1] != '')
						{
							context.outnum.setValue(local_outputPort.split("/")[1]);
							context.outputdevice.setValue(local_outputPort.split(":")[1].split("/")[0]);
						}						
					}
				}				
			}			
		]]></script>
		<if cond="context.IsAlikePort.toBoolean() == true">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'The port data can not alike!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="IsHasValue" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="style" type="string" in="'inport'"/>
				<parameter name="data" type="string" in="context.inputPort.toString()"/>
				<parameter name="result" type="boolean" out="context.result"/>
			</parameters>
		</function>
		<if cond="context.result.toBoolean()==true">
			<then>
				<log level="2">inport</log>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This tunnel is already had!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="IsHasValue" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="style" type="string" in="'outport'"/>
				<parameter name="data" type="string" in="context.outputPort.toString()"/>
				<parameter name="result" type="boolean" out="context.result"/>
			</parameters>
		</function>
		<if cond="context.result.toBoolean()==true">
			<then>
				<log level="2">outputPort</log>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This tunnel is already had!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="IsHasValue" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="style" type="string" in="'invlan'"/>
				<parameter name="data" type="string" in="context.inputvlanid.toString()"/>
				<parameter name="result" type="boolean" out="context.result"/>
			</parameters>
		</function>
		<if cond="context.result.toBoolean()==true">
			<then>
				<log level="2">inputvlanid</log>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This tunnel is already had!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="IsHasValue" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="style" type="string" in="'outvlan'"/>
				<parameter name="data" type="string" in="context.outputvlanid.toString()"/>
				<parameter name="result" type="boolean" out="context.result"/>
			</parameters>
		</function>
		<if cond="context.result.toBoolean()==true">
			<then>
				<log level="2">outputvlanid</log>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This tunnel is already had!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>		
		<if cond="context.putindexof.toLong()!=1">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'Port is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<if cond="context.inputdevice.toString()=='' || context.outputdevice.toString()==''">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="context.resourceid.toLong()"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'Port is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<parameter name="outdevice" type="class" out="context.indevice"/>
				<parameter name="datapathid" type="string" in="context.inputdevice.toString()"/>
			</parameters>
		</function>		
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<parameter name="outdevice" type="class" out="context.outdevice"/>
				<parameter name="datapathid" type="string" in="context.outputdevice.toString()"/>
			</parameters>
		</function>		
		<if cond="context.indevice==null || context.outdevice==null">
			<then>
				<log>indevicde is null or outdevice is null</log>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This id is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="GetPortManager" class="context.indevice">
			<parameters>
				<parameter name="outportmgr" type="class" out="context.indeviceportobj"/>
			</parameters>
		</function>
		<function name="GetPortNumberSize" class="context.indeviceportobj">
			<parameters>
				<parameter name="portnumber" type="long" out="context.indeivceportnum"/>
			</parameters>
		</function>
		<if cond="context.innum.toLong() > context.indeivceportnum.toLong()">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This portnum is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="GetPortManager" class="context.outdevice">
			<parameters>
				<parameter name="outportmgr" type="class" out="context.outdeviceportobj"/>
			</parameters>
		</function>
		<function name="GetPortNumberSize" class="context.outdeviceportobj">
			<parameters>
				<parameter name="portnumber" type="long" out="context.outdeivceportnum"/>
			</parameters>
		</function>
		<if cond="context.outnum.toLong() > context.outdeivceportnum.toLong()">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="-1"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This portnum is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>		
		<function name="addTunnel" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="id" type="long" out="context.resourceid"/>
				<parameter name="username" type="string" in="context.username.toString()"/>
				<parameter name="inputPort" type="string" in="context.inputPort.toString()"/>
				<parameter name="outputPort" type="string" in="context.outputPort.toString()"/>
				<parameter name="type" type="string" in="context.type.toString()"/>
				<parameter name="state" type="string" in="context.state.toString()"/>
				<parameter name="inputvlanid" type="long" in="context.inputvlanid.toLong()"/>
				<parameter name="outputvlanid" type="long" in="context.outputvlanid.toLong()"/>
				<parameter name="bandwidth" type="long" in="context.bandwidth.toLong()"/>
			</parameters>
		</function>
		<function name="GetOneTunnelObject" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="tunnel_id" type="long" in="context.resourceid.toLong()"/>
				<parameter name="TunnelObject" type="class" out="context.tunnel"/>
			</parameters>			
		</function>
		<if cond="context.tunnel==null">
			<then>
				<log>tunnel is null</log>
			</then>
			<else>
				<function name="ActiveTunnel" class="context.tunnel"/>
			</else>
		</if>		
		<script><![CDATA[
			var json = new Object();
			var one = new Object();
			one.resourceId = ""+context.resourceid.toLong();
			one.code = "0";
			one.description = "ok";						
			json.result = one;
			var strjson=JSON.stringify(json);												
			context.outjson.setValue(strjson);
		]]></script>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
				<parameter name="json" type="string" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	<function name="deleteTunnel">
		<variable name="resourceid" type="long"/>
		<variable name="outjson" type="string"/>
		<variable name="tunnel" type="class"/>
		<script><![CDATA[
			var str = event.getParam('requestpath').toString();
			var array = str.split("/");			
			var local_id = array[array.length-1];
			context.resourceid.setValue(local_id);			
		]]></script>
		<function name="GetOneTunnelObject" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="tunnel_id" type="long" in="context.resourceid.toLong()"/>
				<parameter name="TunnelObject" type="class" out="context.tunnel"/>
			</parameters>			
		</function>
		<if cond="context.tunnel==null">
			<then>
				<log>tunnel is null</log>
				<function name="ErrorDataResponse">
					<parameters>
						<parameter name="resourceid" type="long" in="context.resourceid.toLong()"/>
						<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
						<parameter name="description" type="string" in="'This id is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
			<else>
				<function name="DeactiveTunnel" class="context.tunnel"/>
			</else>
		</if>			
		<function name="removeTunnel" class="context.tunnelManagerObject">
			<parameters>
				<parameter name="tunnel_id" type="long" in="context.resourceid.toLong()"/>
			</parameters>
		</function>		
		<script><![CDATA[
			var json = new Object();
			var one = new Object();
			one.resourceId = ""+context.resourceid.toLong();
			one.code = "0";
			one.description = "ok";						
			json.result = one;
			var strjson=JSON.stringify(json);												
			context.outjson.setValue(strjson);
		]]></script>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<parameter name="transportid" type="string" in="event.getParam('transportid').toString()"/>
				<parameter name="json" type="string" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	
	<function name="ErrorDataResponse">
		<parameters>
			<parameter name="resourceid" type="long"/>
			<parameter name="transportid" type="string"/>
			<parameter name="description" type="string"/>
		</parameters>
		<variable name="outjson" type="string"/>
		<script><![CDATA[
			var json = new Object();
			var one = new Object();
			one.resourceId = ""+context.resourceid.toLong();
			one.code = "-1";
			one.description = context.description.toString();						
			json.result = one;
			var strjson=JSON.stringify(json);												
			context.outjson.setValue(strjson);
		]]></script>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<parameter name="transportid" type="string" in="context.transportid.toString()"/>
				<parameter name="json" type="string" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>	
</starosxml>