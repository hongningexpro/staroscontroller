<?xml version="1.0" encoding="UTF-8"?>
<starlang xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
	<!--
		Author:
				YY
		Date:
				2017-09-14
		Copyright: 
				Nanjing StarOS Inc. All rights reserved.
	-->	
	<function name="RegisterHandler">
		<log>insert tunnelserviceapi RegisterHandler</log>
		
		
		<function name="RegisterAPIHandler" class="restfulservice">
			<parameters>
				<long name="bundleid" in="context.getCurrentBundleId()"/>			
				<string name="handleevent" in="'processactiverequest'"/>
				<string name="requestpathtest" in="'/onos/v1/tunnelservice/tunnels/active'"/>			
			</parameters>
		</function>
		<function name="RegisterAPIHandler" class="restfulservice">
			<parameters>
				<long name="bundleid" in="context.getCurrentBundleId()"/>			
				<string name="handleevent" in="'processdeactiverequest'"/>
				<string name="requestpathtest" in="'/onos/v1/tunnelservice/tunnels/deactive'"/>			
			</parameters>
		</function>
		<function name="RegisterAPIHandler" class="restfulservice">
			<parameters>
				<long name="bundleid" in="context.getCurrentBundleId()"/>			
				<string name="handleevent" in="'processtunnelsrequest'"/>
				<string name="requestpathtest" in="'/onos/v1/tunnelservice/tunnels'"/>			
			</parameters>
		</function>
		<function name="RegisterAPIHandler" class="restfulservice">
			<parameters>
				<long name="bundleid" in="context.getCurrentBundleId()"/>			
				<string name="handleevent" in="'processrequest'"/>
				<string name="requestpathtest" in="'/onos/v1/tunnelservice/tunnel'"/>			
			</parameters>
		</function>
	</function>
	
	<function name="UnRegisterHandler">
		<function name="UnRegisterAPIHandler" class="restfulservice">
			<parameters>
				<string name="requestpath" in="'/onos/v1/tunnelservice/tunnels/active'"/>			
			</parameters>
		</function>
		<function name="UnRegisterAPIHandler" class="restfulservice">
			<parameters>
				<string name="requestpath" in="'/onos/v1/tunnelservice/tunnels/deactive'"/>			
			</parameters>
		</function>
		<function name="UnRegisterAPIHandler" class="restfulservice">
			<parameters>
				<string name="requestpath" in="'/onos/v1/tunnelservice/tunnels'"/>			
			</parameters>
		</function>
		<function name="UnRegisterAPIHandler" class="restfulservice">
			<parameters>
				<string name="requestpath" in="'/onos/v1/tunnelservice/tunnel'"/>			
			</parameters>
		</function>
	</function>
	
	<events>
		<onevent event="processactiverequest">
			<log>tunnelserviceapi processactiverequest</log>
			<long name="size"/>
			<function name="getTunnelNum" class="context.tunnelManagerObject">
				<parameters>
					<long name="size" out="context.size"/>
				</parameters>
			</function>
			<if cond="context.size.toLong()==0">
				<then>
					<function name="ErrorDataResponse">
						<parameters>
							<long name="resourceid" in="-1"/>
							<string name="transportid" in="event.getParam('transportid').toString()"/>
							<string name="description" in="'This tunnelcontanier size is null!'"/>
						</parameters>
					</function>
					<exit/>
				</then>
			</if>
			<function name="ActiveTunnel" class="context.tunnelManagerObject"/>
			<string name="outjson"/>
			<script><![CDATA[
				var json = new Object();
				var one = new Object();
				one.resourceId = 0;
				one.code = 0;
				one.description = "ok";						
				json.result = one;
				var strjson=JSON.stringify(json);												
				context.outjson.setValue(strjson);
			]]></script>
			<function name="SendResponse" class="RestfulService">
				<parameters>
					<string name="transportid" in="event.getParam('transportid').toString()"/>
					<string name="json" in="context.outjson.toString()"/>
				</parameters>
			</function>
		</onevent>
		<onevent event="processdeactiverequest">
			<log>tunnelserviceapi processdeactiverequest</log>
			<long name="size"/>
			<function name="getTunnelNum" class="context.tunnelManagerObject">
				<parameters>
					<long name="size" out="context.size"/>
				</parameters>
			</function>
			<if cond="context.size.toLong()==0">
				<then>
					<function name="ErrorDataResponse">
						<parameters>
							<long name="resourceid" in="-1"/>
							<string name="transportid" in="event.getParam('transportid').toString()"/>
							<string name="description" in="'This tunnelcontanier size is null!'"/>
						</parameters>
					</function>
					<exit/>
				</then>
			</if>
			<function name="DeactiveTunnel" class="context.tunnelManagerObject"/>
			<string name="outjson"/>
			<script><![CDATA[
				var json = new Object();
				var one = new Object();
				one.resourceId = 0;
				one.code = 0;
				one.description = "ok";						
				json.result = one;
				var strjson=JSON.stringify(json);												
				context.outjson.setValue(strjson);
			]]></script>
			<function name="SendResponse" class="RestfulService">
				<parameters>
					<string name="transportid" in="event.getParam('transportid').toString()"/>
					<string name="json" in="context.outjson.toString()"/>
				</parameters>
			</function>
		</onevent>
		<onevent event="processtunnelsrequest">
			<log>tunnelserviceapi processtunnelsrequest</log>					
			<function name="getAllTunnels"/>				
		</onevent>
		<onevent event="processrequest">
			<log>tunnelserviceapi processrequest</log>			
			<if cond="event.getParam('method').toString()=='GET'">
				<then>
					<log>insert method get</log>
					<function name="getTunnel"/>
				</then>
				<elseif cond="event.getParam('method').toString()=='PUT'">
					<log>insert method put</log>										
					<function name="updateTunnel"/>
				</elseif>
				<elseif cond="event.getParam('method').toString()=='POST'">
					<log>insert method post</log>	
					<function name="addTunnel"/>
				</elseif>
				<else>
					<log>insert method delete</log>
					<function name="deleteTunnel"/>
				</else>									
			</if>				
		</onevent>
	</events>
	<function name="getAllTunnels">		
		<log>insert getAllTunnels</log>
		<string name="outjson"/>
		<function name="AllTunnelToJsonStr" class="context.tunnelManagerObject">
			<parameters>
				<string name="AllTunnelJsonString" out="context.outjson"/>
			</parameters>
		</function>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<string name="transportid" in="event.getParam('transportid').toString()"/>
				<string name="json" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	<function name="getTunnel">
		<log>insert method == get</log>
		<long name="resourceid"/>
		<object name="tunnel"/>
		<string name="outjson"/>
		<script><![CDATA[
			var str = event.getParam('requestpath').toString();
			var array = str.split("/");
			var local_id = array[array.length-1];
			context.resourceid.setValue(local_id);
		]]></script>		
		<function name="GetOneTunnelObject" class="context.tunnelManagerObject">
			<parameters>
				<long name="tunnel_id" in="context.resourceid.toLong()"/>
				<object name="TunnelObject" out="context.tunnel"/>
			</parameters>
		</function>
		<if cond="context.tunnel==null">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="context.resourceid.toLong()"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This tunnel is null!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="OneTunnelObjectToJsonString" class="context.tunnel">
			<parameters>
				<string name="TunnelObjectToJson" out="context.outjson"/>
			</parameters>
		</function>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<string name="transportid" in="event.getParam('transportid').toString()"/>
				<string name="json" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	<function name="updateTunnel">		
		<log>insert method == put</log>
		<long name="resourceid"/>
		<object name="tunnel"/>
		<string name="outjson"/>
		<string name="username"/>
		<string name="inputPort"/>
		<string name="outputPort"/>
		<string name="type"/>
		<string name="state"/>
		<long name="inputvlanid"/>
		<long name="outputvlanid"/>
		<long name="bandwidth"/>		
		<long name="putindexof" value="0"/>
		<string name="inputdevice" value=""/>
		<string name="outputdevice" value=""/>
		<object name="indevice"/>
		<object name="outdevice"/>
		<boolean name="IsAlikePort" value="false"/>
		<object name="indeviceportobj"/>
		<long name="indeivceportnum"/>
		<long name="innum"/>
		<object name="outdeviceportobj"/>
		<long name="outdeivceportnum"/>
		<long name="outnum"/>
		<script><![CDATA[
			var str = event.getParam('requestpath').toString();
			var array = str.split("/");
			var local_id = array[array.length-1];
			context.resourceid.setValue(local_id);
		]]></script>		
		<function name="GetOneTunnelObject" class="context.tunnelManagerObject">
			<parameters>
				<long name="tunnel_id" in="context.resourceid.toLong()"/>
				<object name="TunnelObject" out="context.tunnel"/>
			</parameters>
		</function>
		<script><![CDATA[									
			var json = JSON.parse(event.getParam('eventdata').toString());
			var local_username = json.username;
			var local_inputport = json.inputPort;
			var local_outputPort = json.outputPort;
			var local_type = json.type;
			var local_state = "active";
			var local_inputvlanid = json.inputvlanid;
			var local_outputvlanid = json.outputvlanid;
			var local_bandwidth = json.bandwidth;
			context.username.setValue(local_username);
			context.inputPort.setValue(local_inputport);
			context.outputPort.setValue(local_outputPort);
			context.type.setValue(local_type);
			context.state.setValue(local_state);
			context.inputvlanid.setValue(local_inputvlanid);
			context.outputvlanid.setValue(local_outputvlanid);
			context.bandwidth.setValue(local_bandwidth);
			if (local_inputport == local_outputPort)
			{
				context.IsAlikePort.setValue(true);
			}
			if ((local_inputport.indexOf("of:") != -1) && (local_outputPort.indexOf("of:") != -1))
			{
				context.putindexof.setValue(1);
				if (local_inputport.split(":")[1] != '')
				{
					if (local_inputport.split(":")[1].split("/")[0] != '')
					{
						if (local_inputport.split("/")[1] != '')
						{
							context.innum.setValue(local_inputport.split("/")[1]);
							context.inputdevice.setValue(local_inputport.split(":")[1].split("/")[0]);
						}
					}
				}
				if (local_outputPort.split(":")[1] != '')
				{
					if (local_outputPort.split(":")[1].split("/")[0] != '')
					{
						if (local_outputPort.split("/")[1] != '')
						{
							context.outnum.setValue(local_outputPort.split("/")[1]);
							context.outputdevice.setValue(local_outputPort.split(":")[1].split("/")[0]);
						}						
					}
				}				
			}
		]]></script>
		<if cond="context.IsAlikePort.toBoolean() == true">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="-1"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'The port data can not alike!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<if cond="context.putindexof.toLong()!=1">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="context.resourceid.toLong()"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'Port is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<if cond="context.inputdevice.toString()=='' || context.outputdevice.toString()==''">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="context.resourceid.toLong()"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'Port is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<object name="outdevice" out="context.indevice"/>
				<string name="datapathid" in="context.inputdevice.toString()"/>
			</parameters>
		</function>		
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<object name="outdevice" out="context.outdevice"/>
				<string name="datapathid" in="context.outputdevice.toString()"/>
			</parameters>
		</function>
		<if cond="context.indevice==null || context.outdevice==null">
			<then>
				<log>indevicde is null or outdevice is null</log>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="context.resourceid.toLong()"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This id is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="GetPortManager" class="context.indevice">
			<parameters>
				<object name="outportmgr" out="context.indeviceportobj"/>
			</parameters>
		</function>
		<function name="GetPortNumberSize" class="context.indeviceportobj">
			<parameters>
				<long name="portnumber" out="context.indeivceportnum"/>
			</parameters>
		</function>
		<if cond="context.innum.toLong() > context.indeivceportnum.toLong()">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="context.resourceid.toLong()"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This portnum is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="GetPortManager" class="context.outdevice">
			<parameters>
				<object name="outportmgr" out="context.outdeviceportobj"/>
			</parameters>
		</function>
		<function name="GetPortNumberSize" class="context.outdeviceportobj">
			<parameters>
				<long name="portnumber" out="context.outdeivceportnum"/>
			</parameters>
		</function>
		<if cond="context.outnum.toLong() > context.outdeivceportnum.toLong()">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="context.resourceid.toLong()"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This portnum is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="UpdateTunnel" class="context.tunnel">
			<parameters>											
				<string name="username" in="context.username.toString()"/>
				<string name="inputPort" in="context.outputPort.toString()"/>
				<string name="outputPort" in="context.outputPort.toString()"/>
				<string name="type" in="context.type.toString()"/>
				<string name="state" in="context.state.toString()"/>
				<long name="inputvlanid" in="context.inputvlanid.toLong()"/>
				<long name="outputvlanid" in="context.outputvlanid.toLong()"/>	
				<long name="bandwidth" in="context.bandwidth.toLong()"/>
			</parameters>
		</function>			
		<script><![CDATA[
			var json = new Object();
			var one = new Object();
			one.resourceId = ""+context.resourceid.toLong();
			one.code = "0";
			one.description = "ok";						
			json.result = one;
			var strjson=JSON.stringify(json);												
			context.outjson.setValue(strjson);
		]]></script>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<string name="transportid" in="event.getParam('transportid').toString()"/>
				<string name="json" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	<function name="addTunnel">
		<string name="username"/>
		<string name="inputPort"/>
		<string name="outputPort"/>
		<string name="type"/>
		<string name="state"/>
		<long name="inputvlanid"/>
		<long name="outputvlanid"/>
		<long name="bandwidth"/>
		<long name="resourceid"/>
		<string name="outjson"/>
		<object name="tunnel"/>
		<string name="inputdevice" value=""/>
		<string name="outputdevice" value=""/>
		<object name="indevice"/>
		<object name="outdevice"/>
		<long name="putindexof" value="0"/>
		<boolean name="result"/>
		<boolean name="IsAlikePort" value="false"/>
		<object name="indeviceportobj"/>
		<long name="indeivceportnum"/>
		<long name="innum"/>
		<object name="outdeviceportobj"/>
		<long name="outdeivceportnum"/>
		<long name="outnum"/>
		<script><![CDATA[									
			var json = JSON.parse(event.getParam('eventdata').toString());
			var local_username = json.username;
			var local_inputport = json.inputPort;
			var local_outputPort = json.outputPort;
			var local_type = json.type;
			var local_state = "active";
			var local_inputvlanid = json.inputvlanid;
			var local_outputvlanid = json.outputvlanid;
			var local_bandwidth = json.bandwidth;
			context.username.setValue(local_username);
			context.inputPort.setValue(local_inputport);
			context.outputPort.setValue(local_outputPort);
			context.type.setValue(local_type);
			context.state.setValue(local_state);
			context.inputvlanid.setValue(local_inputvlanid);
			context.outputvlanid.setValue(local_outputvlanid);
			context.bandwidth.setValue(local_bandwidth);
			if (local_inputport == local_outputPort)
			{
				context.IsAlikePort.setValue(true);
			}
			if ((local_inputport.indexOf("of:") != -1) && (local_outputPort.indexOf("of:") != -1))
			{
				context.putindexof.setValue(1);
				if (local_inputport.split(":")[1] != '')
				{
					if (local_inputport.split(":")[1].split("/")[0] != '')
					{
						if (local_inputport.split("/")[1] != '')
						{
							context.innum.setValue(local_inputport.split("/")[1]);
							context.inputdevice.setValue(local_inputport.split(":")[1].split("/")[0]);
						}
					}
				}
				if (local_outputPort.split(":")[1] != '')
				{
					if (local_outputPort.split(":")[1].split("/")[0] != '')
					{
						if (local_outputPort.split("/")[1] != '')
						{
							context.outnum.setValue(local_outputPort.split("/")[1]);
							context.outputdevice.setValue(local_outputPort.split(":")[1].split("/")[0]);
						}						
					}
				}				
			}			
		]]></script>
		<if cond="context.IsAlikePort.toBoolean() == true">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="-1"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'The port data can not alike!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="IsHasValue" class="context.tunnelManagerObject">
			<parameters>
				<string name="style" in="'inport'"/>
				<string name="data" in="context.inputPort.toString()"/>
				<boolean name="result" out="context.result"/>
			</parameters>
		</function>
		<if cond="context.result.toBoolean()==true">
			<then>
				<log level="2">inport</log>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="-1"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This tunnel is already had!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="IsHasValue" class="context.tunnelManagerObject">
			<parameters>
				<string name="style" in="'outport'"/>
				<string name="data" in="context.outputPort.toString()"/>
				<boolean name="result" out="context.result"/>
			</parameters>
		</function>
		<if cond="context.result.toBoolean()==true">
			<then>
				<log level="2">outputPort</log>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="-1"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This tunnel is already had!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="IsHasValue" class="context.tunnelManagerObject">
			<parameters>
				<string name="style" in="'invlan'"/>
				<string name="data" in="context.inputvlanid.toString()"/>
				<boolean name="result" out="context.result"/>
			</parameters>
		</function>
		<if cond="context.putindexof.toLong()!=1">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="-1"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'Port is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<if cond="context.inputdevice.toString()=='' || context.outputdevice.toString()==''">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="context.resourceid.toLong()"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'Port is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<object name="outdevice" out="context.indevice"/>
				<string name="datapathid" in="context.inputdevice.toString()"/>
			</parameters>
		</function>		
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<object name="outdevice" out="context.outdevice"/>
				<string name="datapathid" in="context.outputdevice.toString()"/>
			</parameters>
		</function>		
		<if cond="context.indevice==null || context.outdevice==null">
			<then>
				<log>indevicde is null or outdevice is null</log>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="-1"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This id is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="GetPortManager" class="context.indevice">
			<parameters>
				<object name="outportmgr" out="context.indeviceportobj"/>
			</parameters>
		</function>
		<function name="GetPortNumberSize" class="context.indeviceportobj">
			<parameters>
				<long name="portnumber" out="context.indeivceportnum"/>
			</parameters>
		</function>
		<if cond="context.innum.toLong() > context.indeivceportnum.toLong()">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="-1"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This portnum is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>
		<function name="GetPortManager" class="context.outdevice">
			<parameters>
				<object name="outportmgr" out="context.outdeviceportobj"/>
			</parameters>
		</function>
		<function name="GetPortNumberSize" class="context.outdeviceportobj">
			<parameters>
				<long name="portnumber" out="context.outdeivceportnum"/>
			</parameters>
		</function>
		<if cond="context.outnum.toLong() > context.outdeivceportnum.toLong()">
			<then>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="-1"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This portnum is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
		</if>		
		<function name="addTunnel" class="context.tunnelManagerObject">
			<parameters>
				<long name="id" out="context.resourceid"/>
				<string name="username" in="context.username.toString()"/>
				<string name="inputPort" in="context.inputPort.toString()"/>
				<string name="outputPort" in="context.outputPort.toString()"/>
				<string name="type" in="context.type.toString()"/>
				<string name="state" in="context.state.toString()"/>
				<long name="inputvlanid" in="context.inputvlanid.toLong()"/>
				<long name="outputvlanid" in="context.outputvlanid.toLong()"/>
				<long name="bandwidth" in="context.bandwidth.toLong()"/>
			</parameters>
		</function>
		<function name="GetOneTunnelObject" class="context.tunnelManagerObject">
			<parameters>
				<long name="tunnel_id" in="context.resourceid.toLong()"/>
				<object name="TunnelObject" out="context.tunnel"/>
			</parameters>			
		</function>
		<if cond="context.tunnel==null">
			<then>
				<log>tunnel is null</log>
			</then>
			<else>
				<function name="ActiveTunnel" class="context.tunnel"/>
			</else>
		</if>		
		<script><![CDATA[
			var json = new Object();
			var one = new Object();
			one.resourceId = ""+context.resourceid.toLong();
			one.code = "0";
			one.description = "ok";						
			json.result = one;
			var strjson=JSON.stringify(json);												
			context.outjson.setValue(strjson);
		]]></script>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<string name="transportid" in="event.getParam('transportid').toString()"/>
				<string name="json" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	<function name="deleteTunnel">
		<long name="resourceid"/>
		<string name="outjson"/>
		<object name="tunnel"/>
		<script><![CDATA[
			var str = event.getParam('requestpath').toString();
			var array = str.split("/");			
			var local_id = array[array.length-1];
			context.resourceid.setValue(local_id);			
		]]></script>
		<function name="GetOneTunnelObject" class="context.tunnelManagerObject">
			<parameters>
				<long name="tunnel_id" in="context.resourceid.toLong()"/>
				<object name="TunnelObject" out="context.tunnel"/>
			</parameters>			
		</function>
		<if cond="context.tunnel==null">
			<then>
				<log>tunnel is null</log>
				<function name="ErrorDataResponse">
					<parameters>
						<long name="resourceid" in="context.resourceid.toLong()"/>
						<string name="transportid" in="event.getParam('transportid').toString()"/>
						<string name="description" in="'This id is wrong!'"/>
					</parameters>
				</function>
				<exit/>
			</then>
			<else>
				<function name="DeactiveTunnel" class="context.tunnel"/>
			</else>
		</if>			
		<function name="removeTunnel" class="context.tunnelManagerObject">
			<parameters>
				<long name="tunnel_id" in="context.resourceid.toLong()"/>
			</parameters>
		</function>		
		<script><![CDATA[
			var json = new Object();
			var one = new Object();
			one.resourceId = ""+context.resourceid.toLong();
			one.code = "0";
			one.description = "ok";						
			json.result = one;
			var strjson=JSON.stringify(json);												
			context.outjson.setValue(strjson);
		]]></script>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<string name="transportid" in="event.getParam('transportid').toString()"/>
				<string name="json" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>
	
	<function name="ErrorDataResponse">
		<parameters>
			<long name="resourceid"/>
			<string name="transportid"/>
			<string name="description"/>
		</parameters>
		<string name="outjson"/>
		<script><![CDATA[
			var json = new Object();
			var one = new Object();
			one.resourceId = ""+context.resourceid.toLong();
			one.code = "-1";
			one.description = context.description.toString();						
			json.result = one;
			var strjson=JSON.stringify(json);												
			context.outjson.setValue(strjson);
		]]></script>
		<function name="SendResponse" class="RestfulService">
			<parameters>
				<string name="transportid" in="context.transportid.toString()"/>
				<string name="json" in="context.outjson.toString()"/>
			</parameters>
		</function>
	</function>	
</starlang>