<starosxml xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
	<!--wangkang 2017/09/19 -->
	<class name="CTunnelDevice">
		<private>
			<variable name="m_deviceid" type="string"/>
			<variable name="m_inputPort" type="string"/>
			<variable name="m_outputPort" type="string"/>
			<variable name="m_flowid" type="string"/>
		</private>	
		<public>
			<function name="CTunnelDevice">
				<parameters>
					<parameter name="deviceid" type="string"/>
					<parameter name="inputPort" type="string"/>
					<parameter name="outputPort" type="string"/>
				</parameters>
				<log>##### CTunnelDevice is create #####</log>
				<set name="thisclass.m_deviceid" value="context.deviceid.toLong()"/>
				<set name="thisclass.m_inputPort" value="context.inputPort.toString()"/>
				<set name="thisclass.m_outputPort" value="context.outputPort.toString()"/>
			</function>
			<function name="GetTunnelDeviceId">
				<parameters>
					<parameter name="outtunneldeviceid" type="string"/>
				</parameters>
				<set name="outtunneldeviceid" value="thisclass.m_deviceid.toString()"/>
			</function>
			<function name="GetInputPort">
				<parameters>
					<parameter name="inputPort" type="string"/>
				</parameters>
				<set name="inputPort" value="thisclass.m_inputPort.toString()"/>
			</function>
			<function name="GetOutputPort">
				<parameters>
					<parameter name="outputPort" type="string"/>
				</parameters>
				<set name="outputPort" value="thisclass.m_outputPort.toString()"/>
			</function>
			<function name="installRuleAtSameDevice">
				<parameters>
					<parameter name="inport" type="string"/>
					<parameter name="invlan" type="string"/>
					<parameter name="outport" type="string"/>
					<parameter name="meterid" type="long"/>
				</parameters>
				<variable name="modstrjson" type="string"/>
				<variable name="onedevice" type="class"/>
				<variable name="oneflowmgr" type="class"/>
				<reference variable="modstrjson">
					<jsonbody><![CDATA[ 
							{
								"xid":"<%=context.openflowserverobj.getIncreaseXID()%>",
								"cookie":"0",
								"cookiemask":"0",
								"tableid":"0",
								"command":"0",
								"idletimeout":"0",
								"hardtimeout":"0",
								"priority":"40000",
								"bufferid":"0xffffffff",
								"outport":"0xffffffff",
								"outgroup":"0xffffffff",
								"flags":"1",
								"match":{
										"type":"1",
										"matchfieldlist":[
											{
												"oxmclass":"0x8000",
												"oxmfield":"6",
												"hasmask":"false",
												"vlanid":"<%=context.invlan.toString()%>"
											},
											{
												"oxmclass":"0x8000",
												"oxmfield":"0",
												"hasmask":"false",
												"inport":"<%=context.inport.toString()%>"
											}
										]
									},
								"instructionlist":[
									{
										"type":"4",
										"actionlist":[
											{
												"type":"0",
												"outport":"<%=context.outport.toString()%>",
												"maxlen":"0xffff"
											}
										]
									},
									{
										"type":"6",
										"meterid":"<%=context.meterid.toLong()%>"
									}
								]
							}
					]]></jsonbody>
				</reference>
				<function name="findDevice" class="DeviceManager">
					<parameters>
						<parameter name="datapathid" type="string" in="thisclass.m_deviceid.toString()"/>
						<parameter name="deviceobject" type="class" out="context.onedevice"/>
					</parameters>
				</function>
				<function name="SetFlowManager" class="onedevice">
					<parameters>
						<parameter name="inflowmgr" type="class" out="context.oneflowmgr"/>
					</parameters>
				</function>
				<if cond="context.oneflowmgr != null">
					<then>
						<log>InstallFlowTableRequest</log>		
						<function name="InstallFlowTableRequest" class="context.oneflowmgr">
							<parameters>
								<parameter name="outflowid" type="string" out="thisclass.m_flowid"/>
								<parameter name="strjson" type="string" in="context.modstrjson.toString()"/>
								<parameter name="appId" type="string" in="'core'"/>
							</parameters>
						</function>
					</then>	
				</if>
			</function>
			<function name="installRuleStart">
				<parameters>
					<parameter name="inport" type="string"/>
					<parameter name="invlan" type="string"/>
					<parameter name="outport" type="string"/>
					<parameter name="meterid" type="long"/>
				</parameters>
				<variable name="modstrjson" type="string"/>
				<variable name="oneflowmgr" type="class"/>
				<variable name="onedevice" type="class"/>
				
				<reference variable="modstrjson">
					<jsonbody><![CDATA[ 
							{
								"xid":"<%=context.openflowserverobj.getIncreaseXID()%>",
								"cookie":"0",
								"cookiemask":"0",
								"tableid":"0",
								"command":"0",
								"idletimeout":"0",
								"hardtimeout":"0",
								"priority":"40000",
								"bufferid":"0xffffffff",
								"outport":"0xffffffff",
								"outgroup":"0xffffffff",
								"flags":"1",
								"match":{
										"type":"1",
										"matchfieldlist":[
											{
												"oxmclass":"0x8000",
												"oxmfield":"6",
												"hasmask":"false",
												"vlanid":"<%=context.invlan.toString()%>"
											},
											{
												"oxmclass":"0x8000",
												"oxmfield":"0",
												"hasmask":"false",
												"inport":"<%=context.inport.toString()%>"
											}
										]
									},
								"instructionlist":[
									{
										"type":"4",
										"actionlist":[
											{
												"type":"0",
												"outport":"<%=context.outport.toString()%>",
												"maxlen":"0xffff"
											}
										]
									},
									{
										"type":"6",
										"meterid":"<%=context.meterid.toLong()%>"
									}
								]
							}
					]]></jsonbody>
				</reference>
				<function name="findDevice" class="DeviceManager">
					<parameters>
						<parameter name="datapathid" type="string" in="thisclass.m_deviceid.toString()"/>
						<parameter name="deviceobject" type="class" out="context.onedevice"/>
					</parameters>
				</function>
				<function name="SetFlowManager" class="onedevice">
					<parameters>
						<parameter name="inflowmgr" type="class" out="context.oneflowmgr"/>
					</parameters>
				</function>
				<if cond="context.oneflowmgr != null">
					<then>
						<log>InstallFlowTableRequest</log>
						<function name="InstallFlowTableRequest" class="context.oneflowmgr">
							<parameters>
								<parameter name="outflowid" type="string" out="thisclass.m_flowid"/>
								<parameter name="strjson" type="string" in="context.modstrjson.toString()"/>
								<parameter name="appId" type="string" in="'core'"/>
							</parameters>
						</function>
					</then>	
				</if>
			</function>
			<function name="installRuleMid">
				<parameters>
					<parameter name="inport" type="string"/>
					<parameter name="invlan" type="string"/>
					<parameter name="outport" type="string"/>
				</parameters>
				<variable name="modstrjson" type="string"/>
				<variable name="oneflowmgr" type="class"/>
				<variable name="onedevice" type="class"/>
				<reference variable="modstrjson">
					<jsonbody><![CDATA[ 
							{
								"xid":"<%=context.openflowserverobj.getIncreaseXID()%>",
								"cookie":"0",
								"cookiemask":"0",
								"tableid":"0",
								"command":"0",
								"idletimeout":"0",
								"hardtimeout":"0",
								"priority":"40000",
								"bufferid":"0xffffffff",
								"outport":"0xffffffff",
								"outgroup":"0xffffffff",
								"flags":"1",
								"match":{
										"type":"1",
										"matchfieldlist":[
											{
												"oxmclass":"0x8000",
												"oxmfield":"6",
												"hasmask":"false",
												"vlanid":"<%=context.invlan.toString()%>"
											},
											{
												"oxmclass":"0x8000",
												"oxmfield":"0",
												"hasmask":"false",
												"inport":"<%=context.inport.toString()%>"
											}
										]
									},
								"instructionlist":[
									{
										"type":"4",
										"actionlist":[
											{
												"type":"0",
												"outport":"<%=context.outport.toString()%>",
												"maxlen":"0xffff"
											}
										]
									}
								]
							}
					]]></jsonbody>
				</reference>
				<function name="findDevice" class="DeviceManager">
					<parameters>
						<parameter name="datapathid" type="string" in="thisclass.m_deviceid.toString()"/>
						<parameter name="deviceobject" type="class" out="context.onedevice"/>
					</parameters>
				</function>
				<function name="SetFlowManager" class="onedevice">
					<parameters>
						<parameter name="inflowmgr" type="class" out="context.oneflowmgr"/>
					</parameters>
				</function>
				<if cond="context.oneflowmgr != null">
					<then>
						<log>InstallFlowTableRequest</log>
						<function name="InstallFlowTableRequest" class="context.oneflowmgr">
							<parameters>
								<parameter name="outflowid" type="string" out="thisclass.m_flowid"/>
								<parameter name="strjson" type="string" in="context.modstrjson.toString()"/>
								<parameter name="appId" type="string" in="'core'"/>
							</parameters>
						</function>
					</then>	
				</if>
			</function>
			<function name="installRuleEnd">
				<parameters>
					<parameter name="inport" type="string"/>
					<parameter name="invlan" type="string"/>
					<parameter name="outport" type="string"/>
					<parameter name="meterid" type="long"/>
				</parameters>
				<variable name="modstrjson" type="string"/>
				<variable name="oneflowmgr" type="class"/>
				<variable name="onedevice" type="class"/>
				<reference variable="modstrjson">
					<jsonbody><![CDATA[ 
							{
								"xid":"<%=context.openflowserverobj.getIncreaseXID()%>",
								"cookie":"0",
								"cookiemask":"0",
								"tableid":"0",
								"command":"0",
								"idletimeout":"0",
								"hardtimeout":"0",
								"priority":"40000",
								"bufferid":"0xffffffff",
								"outport":"0xffffffff",
								"outgroup":"0xffffffff",
								"flags":"1",
								"match":{
										"type":"1",
										"matchfieldlist":[
											{
												"oxmclass":"0x8000",
												"oxmfield":"6",
												"hasmask":"false",
												"vlanid":"<%=context.invlan.toString()%>"
											},
											{
												"oxmclass":"0x8000",
												"oxmfield":"0",
												"hasmask":"false",
												"inport":"<%=context.inport.toString()%>"
											}
										]
									},
								"instructionlist":[
									{
										"type":"4",
										"actionlist":[
											{
												"type":"18",
												"maxlen":"0xffff"
											},
											{
												"type":"0",
												"outport":"<%=context.outport.toString()%>",
												"maxlen":"0xffff"
											}
										]
									},
									{
										"type":"6",
										"meterid":"<%=context.meterid.toLong()%>"
									}
								]
							}
					]]></jsonbody>
				</reference>
				<function name="findDevice" class="DeviceManager">
					<parameters>
						<parameter name="datapathid" type="string" in="thisclass.m_deviceid.toString()"/>
						<parameter name="deviceobject" type="class" out="context.onedevice"/>
					</parameters>
				</function>
				<function name="SetFlowManager" class="onedevice">
					<parameters>
						<parameter name="inflowmgr" type="class" out="context.oneflowmgr"/>
					</parameters>
				</function>
				<if cond="context.oneflowmgr != null">
					<then>
						<log>InstallFlowTableRequest</log>
						<function name="InstallFlowTableRequest" class="context.oneflowmgr">
							<parameters>
								<parameter name="outflowid" type="string" out="thisclass.m_flowid"/>
								<parameter name="strjson" type="string" in="context.modstrjson.toString()"/>
								<parameter name="appId" type="string" in="'core'"/>
							</parameters>
						</function>
					</then>	
				</if>
			</function>
		</public>
	</class>	
</starosxml>