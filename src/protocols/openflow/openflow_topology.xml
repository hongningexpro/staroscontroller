<?xml version="1.0" encoding="UTF-8"?>
<starlang xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
	<events>
		<onevent event="Topology.OnPathRemoveEvent">
			<function>
				<log>Topology.OnPathRemoveEvent</log>
				<string name="removedata"/>
				<script>
					<![CDATA[
					var fromdevice = event.getParam('fromdevice').toString();
					var todevice = event.getParam('todevice').toString();
					var path = event.getParam('path').toString();
					var info = JSON.parse(path);
					var json = new Object();
					json['event'] = "removeLink";
					var payload = new Object();
					payload['id'] = "of:" + fromdevice + "/" + info.paths[0].src.port + "-of:" + todevice + "/" + info.paths[0].dst.port;
					payload['type'] = "direct";
					payload['expected'] = false;
					payload['online'] = true;
					payload['linkWidth'] = 1.2;
					payload['src'] = "of:" + fromdevice;
					payload['srcPort'] = info.paths[0].src.port;
					payload['dst'] = "of:" + todevice;
					payload['dstPort'] = info.paths[0].dst.port;
					json['payload'] = payload;
					var strjson=JSON.stringify(json);
					context.removedata.setValue(strjson);

					]]>
				</script>
			</function>
			<function name="SendToAllClient" class="WebSocketManager">
				<parameters>
					<string name="strjson" in="context.removedata.toString()"/>
				</parameters>
			</function>
			<function name="ProcessRemoveTopoEvent" class="TopoService">
				<parameters>
					<string name="fromdevice" in="event.getParam('fromdevice').toString()"/>
					<string name="todevice" in="event.getParam('todevice').toString()"/>
					<string name="path" in="event.getParam('path').toString()"/>
				</parameters>
			</function>

			<function name="RemovePath" class="TopoManager">
				<parameters>
					<string name="fromdevice" in="event.getParam('fromdevice').toString()"/>
					<string name="todevide" in="event.getParam('todevice').toString()"/>
					<string name="path" in="event.getParam('path').toString()"/>
				</parameters>
			</function>


		</onevent>
		<onevent event="Topology.OnPathAddEvent">
			<function>
				<log>Topology.OnPathAddEvent</log>
				<string name="adddata"/>
				<string name="isTorF" value="false"/>
				<script>
					<![CDATA[
					var fromdevice = event.getParam('fromdevice').toString();
					var todevice = event.getParam('todevice').toString();
					var path = event.getParam('path').toString();
					var info = JSON.parse(path);
					if (info.paths.length == 1)
					{
					var json = new Object();
					json['event'] = "addLink";
					var payload = new Object();
					payload['id'] = "of:" + fromdevice + "/" + info.paths[0].src.port + "-of:" + todevice + "/" + info.paths[0].dst.port;
					payload['type'] = "direct";
					payload['expected'] = false;
					payload['online'] = true;
					payload['linkWidth'] = 1.2;
					payload['src'] = "of:" + fromdevice;
					payload['srcPort'] = info.paths[0].src.port;
					payload['dst'] = "of:" + todevice;
					payload['dstPort'] = info.paths[0].dst.port;
					json['payload'] = payload;
					var strjson=JSON.stringify(json);
					context.adddata.setValue(strjson);
					context.isTorF.setValue("true");
					}
					]]>
				</script>
				<if cond="context.isTorF.toString() == 'true'">
					<then>
						<function name="SendToAllClient" class="WebSocketManager">
							<parameters>
								<string name="strjson" in="context.adddata.toString()"/>
							</parameters>
						</function>
					</then>
				</if>
			</function>
			<function name="ProcessAddTopoEvent" class="TopoService">
				<parameters>
					<string name="fromdevice" in="event.getParam('fromdevice').toString()"/>
					<string name="todevice" in="event.getParam('todevice').toString()"/>
					<string name="path" in="event.getParam('path').toString()"/>
				</parameters>
			</function>

			
			<function name="AddPath" class="TopoManager">
				<parameters>
					<string name="fromdevice" in="event.getParam('fromdevice').toString()"/>
					<string name="todevide" in="event.getParam('todevice').toString()"/>
					<string name="path" in="event.getParam('path').toString()"/>
				</parameters>
			</function>
		</onevent>

	</events>
</starlang>