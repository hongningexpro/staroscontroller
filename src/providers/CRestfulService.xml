<?xml version="1.0" encoding="UTF-8"?>
<starosxml xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
	<!--Restful API Service-->
	<class name="CRestfulService">
		<public>
			<function name="CRestfulService">
				<log>CRestfulService is create</log>
			</function>
			<function name="RegisterAPIHandler">
				<parameters>
					<parameter name="bundleid" type="long"/>			
					<parameter name="handleevent" type="string"/>
					<parameter name="requestpathtest" type="string"/>			
				</parameters>
				<variable name="apiobj" type="class" />
				<new name="apiobj" class="CRestfulAPIEntry">
					<parameters>
						<parameter name="bundleid" type="long" in="context.bundleid"/>			
						<parameter name="eventname" type="string" in="context.handleevent.toString()"/>
						<parameter name="restfullurl" type="string" in="context.requestpathtest.toString()"/>		
					</parameters>
				</new>
				<function name="AddAPIHandler" class="RestfulAPIManager">
					<parameters>
						<parameter name="requestpath2222" type="string" in="context.requestpathtest.toString()"/>
						<parameter name="handler" type="class" in="context.apiobj"/>
					</parameters>
				</function>
			</function>
			<function name="UnRegisterAPIHandler">
				<parameters>
					<parameter name="requestpath" type="string"/>			
				</parameters>
				<function name="RemoveAPIHandler" class="RestfulAPIManager">
					<parameters>
						<parameter name="requestpath" type="string" in="context.requestpath.toString()"/>
					</parameters>
				</function>
			</function>
			
			
			<function name="HandleAPI">
				<parameters>
					<parameter name="requestpath" type="string"/>
					<parameter name="method" type="string"/>
					<parameter name="eventdata" type="string"/>
				</parameters>
				<variable name="handlerobj" type="class"/>
				<variable name="eventname" type="string"/>
				<variable name="bundleid" type="long"/>
				<variable name="eventparam" type="params"/>
				<!--qiulei 20170824 pm-->
				<function name="GetHandler" class="RestfulAPIManager">
					<parameters>
						<parameter name="requestpath" type="string" in="context.requestpath.toString()"/>
						<parameter name="handler" type="class" out="context.handlerobj"/>
					</parameters>
				</function>
				<if cond="context.handlerobj != null">
					<then>
						<function name="GetAPIInfo" class="handlerobj">
							<parameters>
								<parameter name="eventname" type="string" out="context.eventname"/>
								<parameter name="bundleid" type="long" out="context.bundleid"/>
							</parameters>
						</function>
						<set name="eventparam" paramname="eventdata" value="context.eventdata.toString()"/>
						<set name="eventparam" paramname="method" value="context.method.toString()"/>
						<raise name="context.eventname.toString()" bundleid="context.bundleid.toLong()" param="context.eventparam"/>
					</then>
					<else>
						<function>
							<reference variable="errorjson">
									<jsonbody><![CDATA[ 
										{"code":"404","message":"HTTP 404 Not Found"}
									]]></jsonbody>
							</reference>
							<set name="httpparam" paramname="Server" value="'StarOS'"/>
							<set name="httpparam" paramname="Connection" value="'Close'"/>
							<set name="httpparam" paramname="Content-Type" value="'application/json'"/>
							<restful name="restfulserver" action="RESPONSE" status="404" text="ok" transportid="event.getParam('transportid').toString()" httpparams="httpparam">
								<jsonsrc src="errorjson"/>
							</restful>
						</function>
					</else>
				</if>
			</function>
		</public>
	</class>
</starosxml>