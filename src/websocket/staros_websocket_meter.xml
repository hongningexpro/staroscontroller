<?xml version="1.0" encoding="UTF-8"?>
<starosxml xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
	<function name="HandleMeterDataRequest">
		<variable name="deviceid" type="string"/>
		<variable name="outjson" type="string"/>
		<variable name="deviceobj" type="class"/>
		<variable name="meterobj" type="class"/>
		<script><![CDATA[
			var info = JSON.parse(event.getParam("eventdata").toString());
			var devId = info.payload.devId;
			var deviceids=devId.split(":")[1];
			context.deviceid.setValue(deviceids);
			
		]]></script>
		<!--
		{
			"event":"meterDataResponse",
			"payload":{
			"meters":[
			{
			"id":"sss",
			"app_id":"sss",
			"state":"sss",
			"packets":"ss",
			"bytes":"ss",
			"bands":"
			},
			{
			"id":"sss",
			"app_id":"sss",
			"state":"sss",
			"packets":"ss",
			"bytes":"ss",
			"bands":"
			}
			]
			}
		}
		-->
		<function name="getDevice" class="DeviceManager">
			<parameters>
				<parameter name="outdevice" type="class" out="context.deviceobj"/>
				<parameter name="datapathid" type="string" in="context.deviceid.toString()"/>
			</parameters>
		</function>
		<function name="GetMeterManager" class="context.deviceobj">
			<parameters>
				<parameter name="outmetermgr" type="class" out="context.meterobj"/>
			</parameters>
		</function>
		<function name="GetAllMeterJsonData" class="context.meterobj">	
			<parameters>
				<parameter name="jsonstring" type="string" out="context.outjson"/>
			</parameters>
		</function>	
		<websocket name="restfulserver" method="SendText" transportid="event.getParam('transportid').toString()">
			<jsonsrc src="outjson"/>
		</websocket>
	</function>
</starosxml>