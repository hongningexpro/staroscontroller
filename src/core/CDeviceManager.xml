<?xml version="1.0" encoding="UTF-8"?>
<starosxml xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">	
	<class name="CDeviceManager">
		<private>
			<container name="deviceContainer" type="hashmap" keytype="string" valuetype="class"/>
			<container name="t2dContainer" type="hashmap" keytype="string" valuetype="string"/>
		</private>
		<public>
			<function name="addDevice">
				<parameters>
					<parameter name="mfrdesc" type="string"/>
					<parameter name="swdesc" type="string"/>
					<parameter name="serialnum" type="string"/>
					<parameter name="dpdesc" type="string"/>
					<parameter name="hwdesc" type="string"/>
					<parameter name="transportid" type="string"/>
					<parameter name="datapathid" type="string"/>
					<parameter name="localipaddr" type="string"/>
					<parameter name="peeripaddr" type="string"/>
					<parameter name="masterid" type="string"/>	
					<parameter name="type" type="string"/>
					<parameter name="online" type="string"/>
					<parameter name="protocol" type="string"/>					
				</parameters>
				<variable name="deviceobject" type="class"/>
				<variable name="outtransid" type="string"/>
				<new name="deviceobject" class="CDevice">
					<parameters>
						<parameter name="mfrdesc" type="string" in="context.mfrdesc.toString()"/>
						<parameter name="swdesc" type="string" in="context.swdesc.toString()"/>
						<parameter name="serialnum" type="string" in="context.serialnum.toString()"/>
						<parameter name="dpdesc" type="string" in="context.dpdesc.toString()"/>
						<parameter name="hwdesc" type="string" in="context.hwdesc.toString()"/>
						<parameter name="transportid" type="string" in="context.transportid.toString()"/>
						<parameter name="datapathid" type="string" in="context.datapathid.toString()"/>
						<parameter name="localipaddr" type="string" in="context.localipaddr.toString()"/>
						<parameter name="peeripaddr" type="string" in="context.peeripaddr.toString()"/>
						<parameter name="masterid" type="string" in="context.masterid.toString()"/>		
						<parameter name="type" type="string" in="context.type.toString()"/>
						<parameter name="online" type="string" in="context.online.toString()"/>
						<parameter name="protocol" type="string" in="context.protocol.toString()"/>	
					</parameters>
				</new>
				<insert name="deviceContainer" key="context.datapathid.toString()" value="context.deviceobject"/>
				<insert name="t2dContainer" key="context.transportid.toString()" value="context.datapathid.toString()"/>
				<variable name="onlinejson" type="string"/>
				<function name="ToOnlineJson" class="deviceobject">
					<parameters>
						<parameter name="strjson" type="string" out="onlinejson"/>
					</parameters>
				</function>
				<log><![CDATA[onlinejson =<%=context.onlinejson.toString()%>]]></log>
				<function name="SendToAllClient" class="WebSocketManager">
					<parameters>
						<parameter name="strjson" type="string" in="context.onlinejson.toString()"/>
					</parameters>
				</function>
				<function name="GetTransportId" class="deviceobject">
					<parameters>
						<parameter name="outtransport" type="string" out="outtransid"/>
					</parameters>
				</function>
				<log><![CDATA[addDevice outtransid =<%=context.outtransid.toString()%>]]></log>
			</function>
				
			<function name="findDevice">
				<parameters>
					<parameter name="datapathid" type="string"/>
					<parameter name="deviceobject" type="class"/>
				</parameters>
				<variable name="deviceinfo" type="class"/>
				<if cond="context.deviceContainer.hasValue(context.datapathid.toString())==true">
					<then>
						<function>
							<lookup name="deviceContainer" key="context.datapathid.toString()" output="context.deviceinfo"/>
						</function>
					</then>
				</if>
				<set name="deviceobject" value="context.deviceinfo"/>
			</function>
			
			<function name="removeDevice">
				<parameters>
					<parameter name="datapathid" type="string"/>
				</parameters>
				<log><![CDATA[removeDevice device size=<%=context.deviceContainer.size()%>]]></log>
				<variable name="deviceobject" type="class"/>
				<variable name="offlinejson" type="string"/>
				<variable name="devicetransportid" type="string"/>
				<if cond="context.deviceContainer.hasValue(context.datapathid.toString())==true">
					<then>
						<function>
							<lookup name="deviceContainer" key="context.datapathid.toString()" output="context.deviceobject"/>
							<function name="ToOfflineJson" class="deviceobject">
								<parameters>
									<parameter name="strjson" type="string" out="offlinejson"/>
								</parameters>
							</function>
							<function name="SendToAllClient" class="WebSocketManager">
								<parameters>
									<parameter name="strjson" type="string" in="context.offlinejson.toString()"/>
								</parameters>
							</function>
						<function name="GetTransportId" class="deviceobject">
								<parameters>
									<parameter name="outtransport" type="string" out="context.devicetransportid"/>
								</parameters>
							</function>
							<remove name="deviceContainer" key="context.datapathid.toString()"/>
							<remove name="t2dContainer" key="context.devicetransportid.toString()"/>
						</function>
					</then>
				</if>
			</function>
			<function name="GetDatapathIdByTransportid">
				<parameters>
					<parameter name="transportid" type="string"/>
					<parameter name="datapathid" type="string"/>
				</parameters>
				<set name="datapathid" value="context.t2dContainer.getValue(context.transportid.toString())"/>
			</function>
			<function name="GetTransportIdFromDevice">
				<parameters>
					<parameter name="datapathid" type="string"/>
					<parameter name="transportid" type="string"/>
				</parameters>
				<variable name="deviceinfo" type="class"/>
				<variable name="devicedatapathid" type="string"/>
				<!--qiulei 20170821 Monday am-->
				<if cond="context.deviceContainer.hasValue(context.datapathid.toString())">
					<then>
						<function>
							<set name="deviceinfo" value="context.deviceContainer.getValue(context.datapathid.toString())"/>
							<function name="GetTransportId" class="deviceinfo">
								<parameters>
									<parameter name="outtransport" type="string" out="transportid"/>
								</parameters>
							</function>
						</function>
					</then>
				</if>
			</function>
			<function name="removeDeviceByTransportId">
				<parameters>
					<parameter name="transportid" type="string"/>
				</parameters>
				<variable name="deviceinfo" type="class"/>
				<variable name="devicetransportid" type="string"/>
				<variable name="devicedatapathid" type="string"/>
				<log><![CDATA[removeDeviceByTransportId device size=<%=context.deviceContainer.size()%>]]></log>
				<log><![CDATA[transportid=<%=context.transportid.toString()%>]]></log>
				<for var="i" from="0" to="context.deviceContainer.size()-1">
					<function>			
						<set name="deviceinfo" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
						<function name="GetTransportId" class="deviceinfo">
							<parameters>
								<parameter name="outtransport" type="string" out="context.devicetransportid"/>
							</parameters>
						</function>
						<log><![CDATA[devicetransportid =<%=context.devicetransportid.toString()%>]]></log>
						<if cond="context.devicetransportid.toString() == context.transportid.toString()">
							<then>
								<function name="GetDatapathId" class="deviceinfo">
									<parameters>
										<parameter name="outdatapathid" type="string" out="context.devicedatapathid"/>
									</parameters>
								</function>
								<function name="removeDevice">
									<parameters>
										<parameter name="datapathid" type="string" in="context.devicedatapathid.toString()"/>
									</parameters>
								</function>
							</then>
						</if>
					</function>
				</for>
			</function>
			<function name="SendAddAllDeviceToWebClient">
				<parameters>
					<parameter name="transportid" type="string"/>
				</parameters>
				<variable name="jsonstr" type="string"/>
				<variable name="switchdevice" type="class"/>
				<for var="i" from="0" to="context.deviceContainer.size()-1">
					<log><![CDATA[SendAddAllDeviceToWebClient device size=<%=context.deviceContainer.size()%>]]></log>
					<function>
						<set name="switchdevice" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
						<function name="ToAddDeviceJson" class="context.switchdevice">
							<parameters>
								<parameter name="strjson" type="string" out="jsonstr"/>
							</parameters>
						</function>
						<websocket name="restfulserver" method="SendText" transportid="context.transportid.toString()">
							<jsonsrc src="jsonstr"/>
						</websocket>
					</function>
				</for>
			</function>
			<function name="SendAddAllLinkToWebClient">
				<parameters>
					<parameter name="transportid" type="string"/>
				</parameters>
				<variable name="srcdevice" type="class"/>
				<variable name="dstdevice" type="class"/>
				<variable name="srcport" type="string"/>
				<variable name="srcdevicedpid" type="string"/>
				<variable name="dstdevicedpid" type="string"/>
				<variable name="dstport" type="string"/>
				<variable name="strlink" type="string" value=""/>
				<variable name="binvalidlink" type="string" value="false"/>
				<for var="i" from="0" to="context.deviceContainer.size()-1">
					<log><![CDATA[deviceLength=<%=context.deviceContainer.size()%>]]></log>
					<function>
						<set name="srcdevice" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
						<function name="GetDatapathId" class="srcdevice">
							<parameters>
								<parameter name="outdatapathid" type="string" out="srcdevicedpid"/>
							</parameters>
						</function>
						<function>
							<for var="j" from="0" to="context.deviceContainer.size()-1">
								<set name="dstdevice" value="context.deviceContainer.getValueByIndex(context.j.toLong())"/>
								<function name="GetDatapathId" class="dstdevice">
									<parameters>
										<parameter name="outdatapathid" type="string" out="dstdevicedpid"/>
									</parameters>
								</function>
								<if cond="context.srcdevicedpid.toString()!=context.dstdevicedpid.toString()">
									<then>
										<function>
								<set name="strlink" value="context.openflowserverobj.getShortestPath(context.srcdevicedpid.toString(), context.dstdevicedpid.toString())"/>
								<log><![CDATA[strlink=<%=context.strlink.toString()%>]]></log>
					<script><![CDATA[
							if (context.strlink.toString().length>0)
							{
								var info = JSON.parse(context.strlink.toString());
								if (info.paths.length==1)
								{
									context.dstport.setValue(info.paths[0].dst.port);
									context.srcport.setValue(info.paths[0].src.port);
									context.binvalidlink.setValue('true');
								}
								else 
								{	
									context.binvalidlink.setValue('false');
								}
							}
							else 
							{
								context.binvalidlink.setValue('false');
							}
					]]></script>
									<function>
										<if cond="context.binvalidlink.toString()=='true'">
											<then>
												<function>
													<websocket name="restfulserver" method="SendText" transportid="context.transportid.toString()">
														<jsonbody>
										<![CDATA[
						{
						"event":"addLink","payload":
						{"id":"of:<%=context.srcdevicedpid.toString()%>/<%=context.srcport.toString()%>-of:<%=context.dstdevicedpid.toString()%>/<%=context.dstport.toString()%>",
						"type":"direct",
						"expected":false,
						"online":true,
						"linkWidth":1.2,
						"src":"of:<%=context.srcdevicedpid.toString()%>",
						"srcPort":"<%=context.srcport.toString()%>",
						"dst":"of:<%=context.dstdevicedpid.toString()%>",
						"dstPort":"<%=context.dstport.toString()%>"
						}
						}
										]]>
														</jsonbody>
													</websocket>
												</function>
											</then>
										</if>
									</function>
									</function>
									</then>
								</if>
							</for>
						</function>
					</function>
				</for>
			</function>
			<function name="SendDeviceInfoToWebClient">
				<parameters>
					<parameter name="transportid" type="string"/>
				</parameters>
				<variable name="jsonstr" type="string"/>
				<variable name="sendjsonstr" type="string"/>
				<variable name="switchdevice" type="class"/>
				<container name="deviceinfolist" type="list" valuetype="string"/>
				
				<log><![CDATA[SendDeviceInfoToWebClient devicesize=<%=context.deviceContainer.size()%>]]></log>
				<for var="i" from="0" to="context.deviceContainer.size()-1">
					<function>
						<set name="switchdevice" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
						<function name="GetDeviceInfoJson" class="context.switchdevice">
							<parameters>
								<parameter name="strjson" type="string" out="jsonstr"/>
							</parameters>
						</function>
						<insert name="deviceinfolist" value="context.jsonstr.toString()"/>
					</function>
				</for>
				<script><![CDATA[
					var json = new Object();
					var myArray=new Array();  
					
					for(var i=0;i<context.deviceinfolist.size();i++)
					{									
						var onearray = JSON.parse(context.deviceinfolist.getValueByIndex(i));
						myArray.push(onearray);
					}
					json['event']='deviceDataResponse';
					
					var payload = new Object();
					payload['devices']=myArray;
					
					var annots = new Object();
					annots['no_rows_msg']='No devices found';
					payload['annots']=annots;
					json['payload']=payload;
					var strjson=JSON.stringify(json);
					context.sendjsonstr.setValue(strjson);
				]]></script>
				<log><![CDATA[SendDeviceInfoToWebClient transportid=<%=context.transportid.toString()%>]]></log>
				<log><![CDATA[SendDeviceInfoToWebClient sendjsonstr=<%=context.sendjsonstr.toString()%>]]></log>
				<websocket name="restfulserver" method="SendText" transportid="context.transportid.toString()">
					<jsonsrc src="sendjsonstr"/>
				</websocket>
			</function>
			<function name="SendDetailDeviceInfoToWebClient">
				<parameters>
					<parameter name="transportid" type="string"/>
				</parameters>
				<variable name="jsonstr" type="string"/>
				<variable name="sendjsonstr" type="string"/>
				<variable name="switchdevice" type="class"/>
				<container name="deviceinfolist" type="list" valuetype="string"/>
				
				<log><![CDATA[SendDeviceInfoToWebClient devicesize=<%=context.deviceContainer.size()%>]]></log>
				<for var="i" from="0" to="context.deviceContainer.size()-1">
					<function>
						<set name="switchdevice" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
						<function name="GetDeviceInfoJson" class="context.switchdevice">
							<parameters>
								<parameter name="strjson" type="string" out="jsonstr"/>
							</parameters>
						</function>
						<insert name="deviceinfolist" value="context.jsonstr.toString()"/>
					</function>
				</for>
				<script><![CDATA[
					var json = new Object();
					var myArray=new Array();  
					
					for(var i=0;i<context.deviceinfolist.size();i++)
					{									
						var onearray = JSON.parse(context.deviceinfolist.getValueByIndex(i));
						myArray.push(onearray);
					}
					json['event']='deviceDataResponse';
					
					var payload = new Object();
					payload['devices']=myArray;
					
					var annots = new Object();
					annots['no_rows_msg']='No devices found';
					payload['annots']=annots;
					json['payload']=payload;
					var strjson=JSON.stringify(json);
					context.sendjsonstr.setValue(strjson);
				]]></script>
				<log><![CDATA[SendDeviceInfoToWebClient transportid=<%=context.transportid.toString()%>]]></log>
				<log><![CDATA[SendDeviceInfoToWebClient sendjsonstr=<%=context.sendjsonstr.toString()%>]]></log>
				<websocket name="restfulserver" method="SendText" transportid="context.transportid.toString()">
					<jsonsrc src="sendjsonstr"/>
				</websocket>
			</function>
			<function name="Detect">
				<variable name="thisswitch" type="class"/>
				<variable name="transportid" type="string"/>
				<log>Device Manager Detect</log>
				<for var="i" from="0" to="context.deviceContainer.size()-1">
					<function>
						<set name="thisswitch" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
						<function name="MultiPartPortDescRequest" class="context.thisswitch"/>
					</function>
				</for>
				<!--SendPortState-->
				<log> SendPortStateRequest !!!!!!!!!!!!!!!!!!!</log>
				<function name="SendPortStateRequest"/>
							<log> SendTableRequest !!!!!!!!!!!!!!!!!!!</log>
				<function name="SendTableRequest"/>
				<function name="SendFlowRequest"/>
			</function>
			<function name="DeviceDetailsReqJson">
				<parameters>
					<parameter name="transportid" type="string"/>
					<parameter name="datapathid" type="string"/>
				</parameters>
				<variable name="thisswitch" type="class"/>
				<variable name="sendjsonstr" type="string"/>
				<set name="thisswitch" value="context.deviceContainer.getValue(context.datapathid.toString())"/>
				<function name="ForDeviceDetailReqJson" class="thisswitch">
					<parameters>
						<parameter name="outjson" type="string" out="sendjsonstr"/>
					</parameters>
				</function>
				<log><![CDATA[DeviceDetailsReqJson sendjsonstr=<%=context.sendjsonstr.toString()%>]]></log>
				<websocket name="restfulserver" method="SendText" transportid="context.transportid.toString()">
					<jsonsrc src="sendjsonstr"/>
				</websocket>
			</function>
			<!--YY sendlinks 2017-08-18 -->
			<function name="SendLinks">
				<parameters>
					<parameter name="transportid" type="string"/>
				</parameters>
				<variable name="binvalidlink" type="boolean" value="false"/>
				<variable name="srcport" type="string"/>
				<variable name="srcdevicedpid" type="string"/>
				<variable name="dstdevicedpid" type="string"/>
				<variable name="dstport" type="string"/>
				<variable name="strlink" type="string" value=""/>	
				<variable name="linkarray" type="string"/>				
				<container name="linklist" type="list" valuetype="string"/>
				<variable name="srcdevice" type="class"/>
				<variable name="dstdevice" type="class"/>
				<function>					
					<for var="i" from="0" to="context.deviceContainer.size()-1">			
						<function>
							<set name="srcdevice" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
							<function name="GetDatapathId" class="srcdevice">
								<parameters>
									<parameter name="outdatapathid" type="string" out="srcdevicedpid"/>
								</parameters>
							</function>
							<function>
								<for var="j" from="0" to="context.deviceContainer.size()-1">
									<set name="dstdevice" value="context.deviceContainer.getValueByIndex(context.j.toLong())"/>
									<function name="GetDatapathId" class="dstdevice">
										<parameters>
											<parameter name="outdatapathid" type="string" out="dstdevicedpid"/>
										</parameters>
									</function>
									<if cond="context.srcdevicedpid.toString()!=context.dstdevicedpid.toString()">
										<then>
											<function>
												<set name="strlink" value="context.openflowserverobj.getShortestPath(context.srcdevicedpid.toString(), context.dstdevicedpid.toString())"/>									
												<script><![CDATA[
														if (context.strlink.toString().length>0)
														{
															var info = JSON.parse(context.strlink.toString());
															if (info.paths.length == 1)
															{
																var array = new Object();
																array.one = "of:" + context.srcdevicedpid.toString() + "/" + info.paths[0].src.port;
																array.two = "of:" + context.dstdevicedpid.toString() + "/" + info.paths[0].dst.port;
																array.type = "Direct";
																array._iconid_state = "active";
																array.direction = "A &harr; B";
																array.durable = "false";
																var strjson=JSON.stringify(array);
																context.linklist.addValue(strjson);
																context.binvalidlink.setValue('true');
															}
															else 
															{	
																context.binvalidlink.setValue('false');
															}
														}
														else 
														{
															context.binvalidlink.setValue('false');
														}
												]]></script>
												<function>
													<if cond="context.binvalidlink.toString()=='true'">
														<then>
															<function>
																<websocket name="restfulserver" method="SendText" transportid="context.transportid.toString()">
																	<jsonsrc src="linkarray"/>
																</websocket>
															</function>
														</then>
													</if>
												</function>
											</function>
										</then>
									</if>
								</for>
							</function>
						</function>
					</for>
					<log><![CDATA[linklist size=<%=context.linklist.size()%>]]></log>
					<script><![CDATA[				
						var json = new Object();
						var myArray=new Array();
						for(var i=0;i<context.linklist.size();i++)
						{
							var onestrjson = context.linklist.getValueByIndex(i);
							var jsoninfo = JSON.parse(onestrjson);
							myArray.push(jsoninfo);
						}
						json['event'] = "linkDataResponse";							
						var payload = new Object();
						payload['links'] = myArray;				
						var annots_arr = new Array();
						var paytwoarray = new Object();
						paytwoarray.no_rows_msg = "No links found";
						annots_arr.push(paytwoarray);
						payload['annots'] = annots_arr;	
						json['payload'] = payload;				
						var strjson=JSON.stringify(json);				
						context.linkarray.setValue(strjson);				
						context.print(strjson);
						context.binvalidlink.setValue(true);
					]]></script>
				</function>
				
				
				<if cond="context.binvalidlink.toBoolean()==true">
					<then>
						<function>
							<websocket name="restfulserver" method="SendText" transportid="context.transportid.toString()">
								<jsonsrc src="linkarray"/>
							</websocket>
						</function>
					</then>
				</if>
			</function>
			<!--Send Request Device Detail information -->
			
			
			
			
			
			<!--hupeng 20170818-->
			
			<function name="sendhighlights">
				<parameters>
					<parameter name="transportid" type="string"/>
					<parameter name="trafficType" type="string"/>
				</parameters>
				<variable name="binvalidlink" type="boolean" value="false"/>
				<variable name="srcdevicedpid" type="string"/>
				<variable name="dstdevicedpid" type="string"/>
				<variable name="strlink" type="string" value=""/>	
				<variable name="linkarray" type="string"/>				
				<container name="linklist" type="list" valuetype="string"/>
				<variable name="srcdevice" type="class"/>
				<variable name="dstdevice" type="class"/>
				<log><![CDATA[sendhighlights!!!!!!!!!!!!!!! size=<%=context.deviceContainer.size()%>]]></log>
				<function>					
					<for var="i" from="0" to="context.deviceContainer.size()-1">			
						<function>
							<set name="srcdevice" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
							<function name="GetDatapathId" class="srcdevice">
								<parameters>
									<parameter name="outdatapathid" type="string" out="srcdevicedpid"/>
								</parameters>
							</function>
							<function>
								<for var="j" from="0" to="context.deviceContainer.size()-1">
									<set name="dstdevice" value="context.deviceContainer.getValueByIndex(context.j.toLong())"/>
									<function name="GetDatapathId" class="dstdevice">
										<parameters>
											<parameter name="outdatapathid" type="string" out="dstdevicedpid"/>
										</parameters>
									</function>
									<if cond="context.srcdevicedpid.toString()!=context.dstdevicedpid.toString()">
										<then>
											<function>
												<set name="strlink" value="context.openflowserverobj.getShortestPath(context.srcdevicedpid.toString(), context.dstdevicedpid.toString())"/>									
												<script><![CDATA[
														if (context.strlink.toString().length>0)
														{
															var info = JSON.parse(context.strlink.toString());
															if (info.paths.length == 1)
															{
																context.binvalidlink.setValue("true");										
																if (context.trafficType.toString()=="portStatsPktSec")
																{
																	var onearray = new Object();
																	onearray.id = "of:" + context.srcdevicedpid.toString()  + "/" + info.paths[0].src.port +"-of:" + context.dstdevicedpid.toString() + "/" + info.paths[0].dst.port;
																	onearray.label = "4pps";
																	onearray.css = "secondary port-traffic-green";	
																	var strjson=JSON.stringify(onearray);
																	context.linklist.addValue(strjson);
																}
																
															}
															else 
															{	
																context.binvalidlink.setValue('false');
															}
														}
														else 
														{
															context.binvalidlink.setValue('false');
														}
												
												]]></script>
												
											</function>
										</then>
									</if>
								</for>
							</function>
						</function>
					</for>
					<log><![CDATA[linklist size=<%=context.linklist.size()%>]]></log>
					<script><![CDATA[				
						var json = new Object();
						var myArray=new Array();
						for(var i=0;i<context.linklist.size();i++)
						{
							var onestrjson = context.linklist.getValueByIndex(i);
							var jsoninfo = JSON.parse(onestrjson);
							myArray.push(jsoninfo);
						}
						json['event'] = "showHighlights";							
						var payload = new Object();
						var devices = new Array();	
						payload['devices'] = devices;	
						var hosts = new Array();
						payload['hosts'] = hosts;
						payload['links'] = myArray;						
						json['payload'] = payload;				
						var strjson=JSON.stringify(json);				
						context.linkarray.setValue(strjson);				
						context.print(strjson);
						
						
					]]></script>
				</function>
					<function>
							<websocket name="restfulserver" method="SendText" transportid="context.transportid.toString()">
								<jsonsrc src="linkarray"/>
							</websocket>
					</function>
					
			</function>
			
			<function name="SendDetails">	
				<parameters>	
					<parameter name="transportid" type="string"/>
					<parameter name="datapathid" type="string"/>	
				</parameters>
				<variable name="deviceobject" type="class"/>
				<set name="deviceobject" value="thisclass.deviceContainer.getValue(context.datapathid.toString())"/>
				<function name="SendDetails" class="deviceobject">
					<parameters>
						<parameter name="transportid" type="string" in="context.transportid.toString()"/>
					</parameters>	
				</function>
			</function>
		<!--Send Packet To All Port By DeviceId-->
			<function name="PacketOutToAllPort">	
				<parameters>
					<parameter name="datapathid" type="string"/>
					<parameter name="inportid" type="string"/>	
					<parameter name="pkoutjson" type="string"/>
					<parameter name="msgblock" type="messageblock"/>
				</parameters>
				<variable name="device" type="class"/>
				<log>PacketOutToAllPort !!!!!!!!!!!!!!</log>
				<if cond="context.deviceContainer.hasValue(context.datapathid.toString())">
					<then>
						<set name="device" value="context.deviceContainer.getValue(context.datapathid.toString())"/>
						<function name="PacketOutToAllPort" class="context.device">
							<parameters>	
								<parameter name="inportid" type="string" in="context.inportid.toString()"/>	
								<parameter name="pkoutjson" type="string" in="context.pkoutjson.toString()"/>
								<parameter name="msgblock" type="messageblock" in="context.msgblock"/>								
							</parameters>
						</function>		
					</then>
				</if>
			</function>
			<!--qiulei 2017.08.23   Send Packet To one Port By DeviceId   -->
			<function name="PacketOutToPort">
				<parameters>
					<parameter name="outputport" type="string"/>
					<parameter name="pkoutjson" type="string"/>
					<parameter name="msgblock" type="messageblock"/>
					<parameter name="inportid" type="string"/>
					<parameter name="datapathid" type="string"/>
				</parameters>
				
				<log><![CDATA[CDeviceManager 中的context.outputport =<%=context.outputport.toString()%>]]></log>
				<log><![CDATA[CDeviceManager 中的context.pkoutjson =<%=context.pkoutjson.toString()%>]]></log>				
				<log><![CDATA[CDeviceManager 中的context.inportid =<%=context.inportid.toString()%>]]></log>
				<log><![CDATA[CDeviceManager 中的context.datapathid =<%=context.datapathid.toString()%>]]></log>
				<log><![CDATA[CDeviceManager 中的context.outputport =<%=context.outputport.toString()%>]]></log>
				<variable name="device" type="class"/>
				<log>PacketOutToPort !!!!!!!!!!!!!!</log>
				<if cond="context.deviceContainer.hasValue(context.datapathid.toString())">
					<then>
						<set name="device" value="context.deviceContainer.getValue(context.datapathid.toString())"/>
						<function name="PacketOutToPort" class="context.device">
							<parameters>
								<parameter name="outputport" type="string" in="context.outputport.toString()"/>
								<parameter name="pkoutjson" type="string" in="context.pkoutjson.toString()"/>
								<parameter name="msgblock" type="messageblock" in="context.msgblock"/>
								<parameter name="inportid" type="string" in="context.inportid.toString()"/>
							</parameters>
						</function>
					</then>
				</if>
			</function>
			
			<function name="GetDatapathId">	
				<parameters>	
					<parameter name="transportid" type="string"/>
				</parameters>
				<variable name="device" type="class"/>
				<log>PacketOutToAllPort !!!!!!!!!!!!!!</log>
				<if cond="context.deviceContainer.hasValue(context.datapathid.toString())">
					<then>
						<set name="device" value="context.deviceContainer.getValue(context.datapathid.toString())"/>
						<function name="PacketOutToAllPort" class="context.device">
							<parameters>	
								<parameter name="inportid" type="string" in="context.inportid.toString()"/>	
								<parameter name="pkoutjson" type="string" in="context.pkoutjson.toString()"/>	
							</parameters>
						</function>		
					</then>
				</if>			
			</function>
			<function name="SendPortStateRequest">
				<variable name="device" type="class"/>
				<for var="i" from="0" to="context.deviceContainer.size()-1">			
					<function>
						<set name="device" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
						<function name="SendPortStateRequest" class="device"/>
					</function>
				</for>
			</function>
			<function name="GetPortsStateJsonData">	
				<parameters>
					<parameter name="datapathid" type="string"/>
					<parameter name="jsonstring" type="string"/>
				</parameters>
				<variable name="device" type="class"/>
				<log>GetPortsStateJsonData !!!!!!!!!!!!!!</log>
				<if cond="context.deviceContainer.hasValue(context.datapathid.toString())">
					<then>
						<set name="device" value="context.deviceContainer.getValue(context.datapathid.toString())"/>
						<function name="GetPortsStateJsonData" class="context.device">
							<parameters>	
								<parameter name="jsonstring" type="string" out="context.jsonstring"/>
							</parameters>
						</function>		
					</then>
				</if>
			</function>	
		<function name="SendFlowRequest">
				<log>insert CDeviceManager SendFlowRequest</log>
				<variable name="device" type="class"/>
				<for var="i" from="0" to="context.deviceContainer.size()-1">			
					<function>
						<set name="device" value="context.deviceContainer.getValueByIndex(context.i.toLong())"/>
						<function name="SendFlowRequest" class="device"/>
					</function>
				</for>
			</function>
			<!----qiulei 20170825-->
			<function name="GetAllMeterJsonData">	
				<parameters>
					<parameter name="datapathid" type="string"/>
					<parameter name="jsonstring" type="string"/>
				</parameters>
				
				<variable name="deviceobject" type="class"/>
				<variable name="metermgr" type="class"/>
				<!--qiulei 20170825 Friday pm-->
				<if cond="context.deviceContainer.hasValue(context.datapathid.toString())==true">
					<then>
						<function>
							<lookup name="deviceContainer" key="context.datapathid.toString()" output="context.deviceobject"/>
							
							
							<function name="GetMetermgr" class="deviceobject">
								<parameters>
									<variable name="metermgr" type="string" out="context.metermgr"/>
								</parameters>
							</function>
							<function name="GetMeterJsonData" class="context.metermgr">	
								<parameters>
									<parameter name="jsonstring" type="string" out="context.jsonstring"/>
								</parameters>
							</function>
							
							
						</function>
					</then>
				</if>
				<log>GetMeterJsonData</log>
			</function>	
		</public>
	</class>
</starosxml>