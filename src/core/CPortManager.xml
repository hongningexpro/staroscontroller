<?xml version="1.0" encoding="UTF-8"?>
<starosxml xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
	<class name="CPort">
		<private>
			<variable name="m_type" type="string" />
			<variable name="m_speed" type="string" />
			<variable name="m_enabled" type="string" />
			<variable name="m_name" type="string" />
			<variable name="m_flags" type="string"/>
			<variable name="m_advertised" type="string"/>
			<variable name="m_config" type="string"/>
			<variable name="m_curr" type="string"/>
			<variable name="m_currspeed" type="string"/>
			<variable name="m_hwaddr" type="string"/>
			<variable name="m_maxspeed" type="string"/>
			<variable name="m_peer" type="string"/>
			<variable name="m_state" type="string"/>
			<variable name="m_supported" type="string"/>
			<variable name="m_portno" type="string"/>
			<variable name="m_elinks_dest" type="string"/>
			<!--PortState-->
			<variable name="m_rxpackets" type="string"/>
			<variable name="m_txpackets" type="string"/>
			<variable name="m_rxbytes" type="string"/>
			<variable name="m_txbytes" type="string"/>
			
			<variable name="m_rxdropped" type="string"/>
			<variable name="m_txdropped" type="string"/>
			<variable name="m_rxerrors" type="string"/>
			<variable name="m_txerrors" type="string"/>
			
			<variable name="m_rxframeerr" type="string"/>
			<variable name="m_rxovererr" type="string"/>
			<variable name="m_rxcrcerr" type="string"/>
			<variable name="m_collisions" type="string"/>
						
			<variable name="m_durationsec" type="string"/>
			<variable name="m_durationnsec" type="string"/>
											<!--qiulei 20170907   add variable name="m_transportid" type="string"-->
			<variable name="m_transportid" type="string"/>
		</private>
		<public>
			<function name="CPort">
				<parameters>
					<parameter name="advertised" type="string"/>			
					<parameter name="portno" type="string"/>
					<parameter name="config" type="string"/>			
					<parameter name="curr" type="string"/>
					<parameter name="currspeed" type="string"/>	
					<parameter name="hwaddr" type="string"/>
					<parameter name="maxspeed" type="string"/>	
					<parameter name="name" type="string"/>	
					<parameter name="peer" type="string"/>
					<parameter name="state" type="string"/>	
					<parameter name="supported" type="string"/>
				<!--qiulei 20170907-->
					<parameter name="transportid" type="string"/>
					
				</parameters>
				<set name="thisclass.m_advertised" value="context.advertised.toString()"/>
				<set name="thisclass.m_portno" value="context.portno.toString()"/>
				<set name="thisclass.m_config" value="context.config.toString()"/>
				<set name="thisclass.m_curr" value="context.curr.toString()"/>
				<set name="thisclass.m_currspeed" value="context.currspeed.toString()"/>
				<set name="thisclass.m_hwaddr" value="context.hwaddr.toString()"/>
				<set name="thisclass.m_name" value="context.name.toString()"/>
				<set name="thisclass.m_peer" value="context.peer.toString()"/>
				<set name="thisclass.m_state" value="context.state.toString()"/>
				<set name="thisclass.m_supported" value="context.supported.toString()"/>
				<set name="thisclass.m_type" value="'Copper'"/>
				<!--qiulei 20170907-->
				<set name="thisclass.m_transportid" value="context.transportid.toString()"/>
				
				<if cond="thisclass.m_state.toString() !='0'">
					<then>
						<function>
							<set name="thisclass.m_enabled" value="'false'"/>
						</function>
					</then>
					<else>
						<function>
							<set name="thisclass.m_enabled" value="'true'"/>
						</function>
					</else>
				</if>
			</function>
			<function name="ForDeviceDetailReqJson">
				<parameters>
					<parameter name="outjson" type="string"/>
				</parameters>
				<log>CPort ForDeviceDetailReqJson</log>
				<variable name="outdetail" type="string" />
				<script><![CDATA[
					var onearray = new Object();
					if (thisclass.m_portno.toString() == 4294967294){ 						
						onearray.id = "Local";						
					}else{
						onearray.id=thisclass.m_portno.toString();
					}
					onearray.type=thisclass.m_type.toString();
					onearray.speed=thisclass.m_currspeed.toString();
					onearray.enabled=thisclass.m_enabled.toString();
					onearray.name=thisclass.m_name.toString();
					onearray.elinks_dest="";
					var strjson = JSON.stringify(onearray);
					context.outdetail.setValue(strjson);
				]]></script>
			<log><![CDATA[ForDeviceDetailReqJson outdetail=<%=context.outdetail.toString()%>]]></log>
				<set name="outjson" value="context.outdetail.toString()"/>
			</function>
			
			<function name="IsReservedPort">
				<parameters>
					<parameter name="returnbool" type="boolean"/>
				</parameters>
				<if cond="thisclass.m_portno.toString()=='4294967295' || thisclass.m_portno.toString()=='4294967294' || thisclass.m_portno.toString()=='‭4294967040‬' || thisclass.m_portno.toString()=='4294967288‬'|| thisclass.m_portno.toString()=='4294967289'|| thisclass.m_portno.toString()=='4294967290'|| thisclass.m_portno.toString()=='4294967291'|| thisclass.m_portno.toString()=='4294967292'|| thisclass.m_portno.toString()=='4294967293'">
					<then>
						<set name="returnbool" value="true"/>
					</then>
					<else>
						<set name="returnbool" value="false"/>
					</else>
				</if>
			</function>
			<function name="GetPortState">
				<parameters>
					<parameter name="outstate" type="string"/>
				</parameters>
				<set name="outstate" value="thisclass.m_state.toString()"/>
			</function>
												<!--qiulei 20170907 start-->
			<function name="IsEdgePort">
				<parameters>
					<parameter name="returnbool" type="boolean"/>
				</parameters>
				
				<variable name="openflowdevice" type="object"/>
				<set name="openflowdevice" value="context.openflowserverobj.getDevice(thisclass.m_transportid.toString())"/>
				<if cond="context.openflowdevice!=null">
					<then>
						<variable name="number" type="long"/>
						<set name="number" value="context.openflowdevice.getNeigborSize(thisclass.m_portno.toString())"/>
						<if cond="context.number.toLong()==0">
							<then>
								<function>
									<set name="returnbool" value="true"/>
									</function>
							</then>
							<else>
								<function>
									<set name="returnbool" value="false"/>
									</function>
							</else>
						</if>
					</then>
					<else>
						<log>insert CPortManager's IsEdgePort first if's else</log>
						<log>openflowdevice is null</log>
					</else>
				</if>
				
			</function>
			<!--qiulei 20170907 end-->
			
			<function name="IsValidatePort">
				<parameters>
					<parameter name="returnbool" type="boolean"/>
				</parameters>
				<log><![CDATA[thisclass.m_portno.toString()=<%=thisclass.m_portno.toString()%>]]></log>

				<if cond="thisclass.m_portno.toString()=='4294967295' || thisclass.m_portno.toString()=='4294967294' || thisclass.m_portno.toString()=='‭4294967040‬' || thisclass.m_portno.toString()=='4294967288‬'|| thisclass.m_portno.toString()=='4294967289'|| thisclass.m_portno.toString()=='4294967290'|| thisclass.m_portno.toString()=='4294967291'|| thisclass.m_portno.toString()=='4294967292'|| thisclass.m_portno.toString()=='4294967293'">
					<then>
						<function>
							<log>returnbool false</log>
							<set name="returnbool" value="false"/>
						</function>
					</then>
					<else>
						<function>
							<log>returnbool true</log>
							<if cond="thisclass.m_state.toString()=='0'">
								<then>
									<function>
										<set name="returnbool" value="true"/>
									</function>
								</then>
								<else>
									<function>
										<log>thisclass.m_state.toString()!='0'</log>
										<log><![CDATA[thisclass.m_state.toString() = <%=thisclass.m_state.toString()%>]]></log>
										<set name="returnbool" value="false"/>
									</function>
								</else>
							</if>
						</function>
					</else>
				</if>
			</function>

			<function name="UpdatePortState">
				<parameters>
					<parameter name="portstate" type="string"/>
				</parameters>
												<script><![CDATA[
						var info = JSON.parse(context.portstate.toString());
						
						thisclass.m_rxpackets.setValue(info.rxpackets);
						thisclass.m_txpackets.setValue(info.txpackets);
						thisclass.m_rxbytes.setValue(info.rxbytes);
						thisclass.m_txbytes.setValue(info.txbytes);
						thisclass.m_rxdropped.setValue(info.rxdropped);
						thisclass.m_txdropped.setValue(info.txdropped);
						thisclass.m_rxerrors.setValue(info.rxerrors);
						thisclass.m_txerrors.setValue(info.txerrors);
						
						thisclass.m_rxframeerr.setValue(info.rxframeerr);
						thisclass.m_rxovererr.setValue(info.rxovererr);
						thisclass.m_rxcrcerr.setValue(info.rxcrcerr);
						thisclass.m_collisions.setValue(info.collisions);
						thisclass.m_durationsec.setValue(info.durationsec);
						thisclass.m_durationnsec.setValue(info.durationnsec);
					
					]]></script>
										</function>
			<function name="GetPortsStateJsonData">
				<parameters>	
					<parameter name="jsonstring" type="string"/>
				</parameters>
				<script><![CDATA[
						var json = new Object();
						
						json['id']=thisclass.m_portno.toString();
						json['pkt_rx']=thisclass.m_rxpackets.toString();
						json['pkt_tx']=thisclass.m_txpackets.toString();
						json['bytes_rx']=thisclass.m_rxbytes.toString();
						json['bytes_tx']=thisclass.m_txbytes.toString();
						json['pkt_rx_drp']=thisclass.m_rxdropped.toString();
						json['pkt_tx_drp']=thisclass.m_txdropped.toString();
						json['duration']=thisclass.m_durationsec.toString();
						var jsonstring=JSON.stringify(json);
						context.jsonstring.setValue(jsonstring);
					]]></script>
			</function>
		</public>
	</class>
	<class name="CPortManager">
		<private>
			<container name="portContainer" type="hashmap" keytype="string" valuetype="class"/>
			<variable name="m_transportid" type="string"/>
		</private>
		<public>
			<function name="CPortManager">
				<parameters>
					<parameter name="transportid" type="string"/>
				</parameters>
				<set name="thisclass.m_transportid" value="context.transportid.toString()"/>
				<log>CPortManager is create</log>
			<function name="MultiPartPortDescRequest"/>
			</function>
			<function name="addPort">
				<parameters>
					<parameter name="advertised" type="string"/>			
					<parameter name="portno" type="string"/>
					<parameter name="config" type="string"/>			
					<parameter name="curr" type="string"/>
					<parameter name="currspeed" type="string"/>	
					<parameter name="hwaddr" type="string"/>
					<parameter name="maxspeed" type="string"/>	
					<parameter name="name" type="string"/>	
					<parameter name="peer" type="string"/>
					<parameter name="state" type="string"/>	
					<parameter name="supported" type="string"/>		
				</parameters>
				<variable name="portobj" type="class" />
				<new name="portobj" class="CPort">
					<parameters>
						<parameter name="advertised" type="string" in="context.advertised.toString()"/>			
						<parameter name="portno" type="string" in="context.portno.toString()"/>
						<parameter name="config" type="string" in="context.config.toString()"/>			
						<parameter name="curr" type="string" in="context.curr.toString()"/>
						<parameter name="currspeed" type="string" in="context.currspeed.toString()"/>	
						<parameter name="hwaddr" type="string" in="context.hwaddr.toString()"/>
						<parameter name="maxspeed" type="string" in="context.maxspeed.toString()"/>	
						<parameter name="name" type="string" in="context.name.toString()"/>	
						<parameter name="peer" type="string" in="context.peer.toString()"/>
						<parameter name="state" type="string" in="context.state.toString()"/>	
						<parameter name="supported" type="string" in="context.supported.toString()"/>		
					<parameter name="transportid" type="string" in="thisclass.m_transportid.toString()"/>
						
					</parameters>
				</new>
				<insert name="portContainer" key="context.portno.toString()" value="context.portobj"/>
			</function>
			<function name="ForDeviceDetailReqJson">
				<parameters>
					<parameter name="outjson" type="string"/>
				</parameters>
				<log>CDevice ForDeviceDetailReqJson</log>
				<variable name="portobj" type="class" />
				<container name="jsonlist" type="list" valuetype="string"/>
				<variable name="strjson" type="string" />
				<for var="i" from="0" to="context.portContainer.size()-1">
					<function>
						<set name="portobj" value="context.portContainer.getValueByIndex(context.i.toLong())"/>
						<function name="ForDeviceDetailReqJson" class="context.portobj">
							<parameters>
								<parameter name="outjson" type="string" out="context.strjson"/>
							</parameters>
							</function>
						<log><![CDATA[ForDeviceDetailReqJson json=<%=context.strjson.toString()%>]]></log>
						<insert name="jsonlist" value="context.strjson.toString()"/>
						</function>
					</for>
				<log><![CDATA[ForDeviceDetailReqJson jsonlist size=<%=context.jsonlist.size()%>]]></log>
				<script><![CDATA[
					var portsArray=new Array();                               
					for(var i=0;i<context.jsonlist.size();i++)
					{
						//context.print(i);			
						var port = context.jsonlist.getValueByIndex(i);	
						var info = JSON.parse(port);						
						portsArray.push(info);
					}
					var strjson=JSON.stringify(portsArray);
					context.outjson.setValue(strjson);
				]]></script>
			</function>
			
			<function name="ForPortDetailReqJson">
				<parameters>
					<parameter name="outjson" type="string"/>
				</parameters>
				<log><![CDATA[ForPortDetailReqJson !!!!!!!!!=<%=event.getParam("eventdata").toString()%>]]></log>
				<script><![CDATA[
					
				]]></script>
			</function>
			
			<function name="GetPortNumberSize">
				<parameters>
					<parameter name="portnumber" type="long"/>
				</parameters>										
				<log>============================================================================================</log>
				<log><![CDATA[context.portContainer.size() size=<%=context.portContainer.size()%>]]></log>
				<log>============================================================================================</log>
				<set name="portnumber" value="context.portContainer.size()"/>										
			</function>
			
			<function name="PacketOutToAllPort">
				<parameters>	
					<parameter name="transportid" type="string"/>
					<parameter name="inportid" type="string"/>	
					<parameter name="pkoutjson" type="string"/>	
					<parameter name="msgblock" type="messageblock"/>
				</parameters>
				<log>insert CPortManager's PacketOutToAllPort</log>				
				<variable name="portobj" type="class" />
				<variable name="isvalidataport" type="boolean"/>
				<variable name="isedgeport" type="boolean"/>
				<for var="i" from="0" to="context.portContainer.size()-1">
					<log>insert CPortManager's PacketOutToAllPort's for</log>
					<log><![CDATA[CPortManager's PacketOutToAllPort's for's i = <%=context.i.toLong()%>]]></log>
					<set name="portobj" value="context.portContainer.getValueByIndex(context.i.toLong())"/>
					<function name="IsValidatePort" class="context.portobj">
						<parameters>
							<parameter name="returnbool" type="boolean" out="context.isvalidataport"/>
						</parameters>
					</function>
					<!--qiulei 20170907 add IsEdgePort Function-->
					<function name="IsEdgePort" class="context.portobj">
						<parameters>
							<parameter name="returnbool" type="boolean" out="context.isedgeport"/>
						</parameters>
					</function>
					
					<if cond="(context.isvalidataport.toBoolean()==true) &amp;&amp;(context.isedgeport.toBoolean()==true)">
						<then>
							<log>insert CPortManager's PacketOutToAllPort's for's first if</log>
							<function>
								<if cond="context.inportid.toString()!=context.portContainer.getKeyByIndex(context.i.toLong())">
									<then>
										<log>insert CPortManager's PacketOutToAllPort's for's second if</log>
										<function name="SendOpenFlowPacketOut">
											<parameters>
												<parameter name="outputport" type="string" in="context.portContainer.getKeyByIndex(context.i.toLong())"/>
												<parameter name="payloadjson" type="string" in="context.pkoutjson.toString()"/>
												<parameter name="transportid" type="string" in="context.transportid.toString()"/>
												<parameter name="msgblock" type="messageblock" in="context.msgblock"/>
											</parameters>
										</function>
									</then>
						
</if>
							</function>						
						</then>
					</if>
				</for>
			</function>
			
			<!--qiulei 20170823 pm-->
			<function name="PacketOutToPort">
				<parameters>
					<parameter name="outputport" type="string"/>
					<parameter name="pkoutjson" type="string"/>
					<parameter name="transportid" type="string"/>
					<parameter name="msgblock" type="messageblock"/>
					<parameter name="inportid" type="string"/>
				</parameters>
				<log>insert CPortManager's PacketOutToPort</log>
				<variable name="portobj" type="class" />
				<variable name="isvalidataport" type="boolean"/>
				
<log><![CDATA[context.outputport =<%=context.outputport.toString()%>]]></log>
				
<if cond="context.portContainer.hasValue(context.outputport.toString())">
					<then>
						<log>insert CPortManager's PacketOutToPort's for's first if</log>
						<set name="portobj" value="context.portContainer.getValue(context.outputport.toString())"/>
						<function name="IsValidatePort" class="context.portobj">
							<parameters>
								<parameter name="returnbool" type="boolean" out="context.isvalidataport"/>
							</parameters>
						</function>
						<if cond="context.isvalidataport.toBoolean()==true">
							<then>
								<log>insert CPortManager's PacketOutToPort's for's second if</log>
								<function name="SendOpenFlowPacketOut">
									<parameters>
										<parameter name="outputport" type="string" in="context.outputport.toString()"/>
										<parameter name="payloadjson" type="string" in="context.pkoutjson.toString()"/>
										<parameter name="transportid" type="string" in="context.transportid.toString()"/>
										<parameter name="msgblock" type="messageblock" in="context.msgblock"/>
									</parameters>
								</function>
							</then>
						</if>
					</then>
					<else>
						<log>--------------------2017.08.23 已发送 else--------------------</log>
					</else>
				</if>
			</function>
			
			<function name="UpdatePortState">
				<parameters>
					<parameter name="portstatestring" type="string"/>
				</parameters>
				<variable name="portno" type="string"/>
				<variable name="portobj" type="class"/>
				<script><![CDATA[
						var info = JSON.parse(context.portstatestring.toString());
						//var stringportno=JSON.stringify(info.portno);
						context.portno.setValue(info.portno);
					]]></script>
				<function name="dumpinfo"/>
				<log><![CDATA[UpdatePortState portno=<%=context.portno.toString()%>]]></log>
				<log><![CDATA[portContainer size=<%=context.portContainer.size()%>]]></log>
				<if cond="context.portContainer.hasValue(context.portno.toString())==true">
					<then>
						<set name="portobj" value="context.portContainer.getValue(context.portno.toString())"/>
						<function name="UpdatePortState" class="context.portobj">
							<parameters>
								<parameter name="portstate" type="string" in="context.portstatestring.toString()"/>
							</parameters>
						</function>
					</then>
					<else>
						<log> don't have the port</log>
					</else>
				</if>
			</function>
			<function name="dumpinfo">
				<variable name="ports" type="string"/>
				<for var="i" from="0" to="context.portContainer.size()-1">
					<set name="ports" value="context.portContainer.getKeyByIndex(context.i.toLong())"/>
					<log><![CDATA[dumpinfo: portno=<%=context.ports.toString()%>]]></log>
				</for>
			</function>
			<function name="GetPortsStateJsonData">
				<parameters>	
					<parameter name="jsonstring" type="string"/>
				</parameters>
				<variable name="ports" type="class"/>
				<container name="infolist" type="list" valuetype="string"/>
				<variable name="stringports" type="string"/>
				<for var="i" from="0" to="context.portContainer.size()-1">
					<set name="ports" value="context.portContainer.getValueByIndex(context.i.toLong())"/>
					<function name="GetPortsStateJsonData" class="ports">
						<parameters>	
							<parameter name="jsonstring" type="string" out="context.stringports"/>
						</parameters>
					</function>
					<insert name="infolist" value="context.stringports.toString()"/>
				</for>
				<script><![CDATA[
					var info = new Object();
					info["event"]="portDataResponse";
					var arrayport =new Array();
					var ports = new Object();
					for (var i=0;i<context.infolist.size();i++)
					{
						var oneportstate = context.infolist.getValueByIndex(i);
						var jsoninfo = JSON.parse(oneportstate);
						arrayport.push(jsoninfo);
					}
					ports["ports"]=arrayport;
					info["payload"]=ports;
					var msg = new Object();
					msg["no_rows_msg"]="No ports found";
					info["annots"]=msg;
					var inforstring=JSON.stringify(info);
					context.jsonstring.setValue(inforstring);
				]]></script>
			</function>
				
			<function name="MultiPartPortDescRequest">
				<variable name="strjson" type="string"/>
				<variable name="xid" type="long"/>
				<variable name="replyjson" type="string"/>
				<container name="portinfo" type="hashmap" keytype="string" valuetype="string"/>
				<container name="deviceportinfo" type="hashmap" keytype="string" valuetype="hashmap"/>
				<set name="xid" value="context.openflowserverobj.getIncreaseXID()"/>
				<function>
					<log dest="stdout">OpenFlowMultiPartPortDescRequest</log>

					<reference variable="strjson">
						<jsonbody><![CDATA[ 
								{
									"xid":"<%=context.xid.toLong()%>"
								}
						]]></jsonbody>
					</reference>
					<function name="Send_OFPT13_MULTIPART_REQUEST.OFP13MP_PORT_DESC">
						<parameters>
							<parameter name="transportid" type="string" in="thisclass.m_transportid.toString()"/>
							<parameter name="strjson" type="string" in="context.strjson.toString()"/>
						</parameters>
					</function>
					<wait event="openflow.OFPT13_MULTIPART_REPLY.OFP13MP_PORT_DESC,openflow.OFPT13_ERROR" transportid="thisclass.m_transportid.toString()"  xid="context.xid.toLong()" timeout="5000">
						<function>
							<log>Hanle OpenFlowMultiPartPortDesc Reply</log>
							<set name="replyjson" value="event.getParam('eventdata').toString()"/>
							<!--parse JSONString-->
							<script><![CDATA[							
								var info = JSON.parse(context.replyjson.toString());
								context.print(info.portlist.length);
								for(var i=0;i<info.portlist.length;i++)
								{
									//yijian add for null var
									var ofport = context.createContainer("hashmap","string","string");
									if (ofport != null)
									{
										ofport.addValue('advertised', info.portlist[i].advertised);
										ofport.addValue('portno', info.portlist[i].portno);
										ofport.addValue('config', info.portlist[i].config);
										ofport.addValue('curr', info.portlist[i].curr);
										ofport.addValue('currspeed', info.portlist[i].currspeed);
										ofport.addValue('hwaddr', info.portlist[i].hwaddr);
										ofport.addValue('maxspeed', info.portlist[i].maxspeed);
										ofport.addValue('name', info.portlist[i].name);
										ofport.addValue('peer', info.portlist[i].peer);
										ofport.addValue('state', info.portlist[i].state);
										ofport.addValue('supported', info.portlist[i].supported);
										context.deviceportinfo.addValue(info.portlist[i].portno, ofport);
									}
								}
							]]></script>

							<log><![CDATA[deviceportinfo size=<%=context.deviceportinfo.size()%>]]></log>
							<for var="i" from="0" to="context.deviceportinfo.size()-1">
								<function>
									<set name="portinfo" value="context.deviceportinfo.getValueByIndex(context.i.toLong())"/>
									<function name="addPort">
										<parameters>
											<parameter name="advertised" type="string" in="context.portinfo.getValue('advertised').toString()"/>			
											<parameter name="portno" type="string" in="context.portinfo.getValue('portno').toString()"/>
											<parameter name="config" type="string" in="context.portinfo.getValue('config').toString()"/>			
											<parameter name="curr" type="string" in="context.portinfo.getValue('curr').toString()"/>
											<parameter name="currspeed" type="string" in="context.portinfo.getValue('currspeed').toString()"/>	
											<parameter name="hwaddr" type="string" in="context.portinfo.getValue('hwaddr').toString()"/>
											<parameter name="maxspeed" type="string" in="context.portinfo.getValue('maxspeed').toString()"/>	
											<parameter name="name" type="string" in="context.portinfo.getValue('name').toString()"/>	
											<parameter name="peer" type="string" in="context.portinfo.getValue('peer').toString()"/>
											<parameter name="state" type="string" in="context.portinfo.getValue('state').toString()"/>	
											<parameter name="supported" type="string" in="context.portinfo.getValue('supported').toString()"/>
										</parameters>
									</function>
								</function>
							</for>
						</function>
					</wait>
					<log>OpenFlowMultiPartPortDescRequest end</log>
				</function>
			</function>	
			<!-- hu 20170904 SendPortStateRequest 
			1)get portstatslist and portstatestring
			2)send port portstatestring
			-->
			<function name="SendPortStateRequest">
				<variable name="xid" type="long"/>
				<set name="xid" value="context.openflowserverobj.getIncreaseXID()"/>
				<container name="portstatelist" type="list"  valuetype="string"/>
				<variable name="portstatestring" type="string"/>
				<function name="OpenFlowMultiPartPortStatsRequest">
					<parameters>
						<parameter name="portno" type="string" in="'0xffffffff'"/>
						<parameter name="transportid" type="string" in="thisclass.m_transportid"/>
						<parameter name="xid" type="long" in="context.xid.toLong()"/>
					</parameters>
				</function>
				<wait event="openflow.OFPT13_MULTIPART_REPLY.OFP13MP_PORT_STATS,openflow.OFPT13_ERROR" transportid="context.m_transportid.toString()" xid="context.xid.toLong()">
					<function>
						<script><![CDATA[
								var info = JSON.parse(event.getParam('eventdata').toString());
								
								for(var i=0;i<info.portstatslist.length;i++)
								{
									var portstats = info.portstatslist[i];
									var portstrjson=JSON.stringify(portstats);
									context.portstatelist.addValue(portstrjson);
								}
							]]></script>
					</function>
				</wait>
				<log><![CDATA[portstatelist size=<%=context.portstatelist.size()%>]]></log>
				<for var="i" from="0" to="context.portstatelist.size()-1">
					<set name="portstatestring" value="context.portstatelist.getValueByIndex(context.i.toLong())"/>
					<function name="UpdatePortState">
						<parameters>
							<parameter name="portstatestring" type="string" in="context.portstatestring.toString()"/>
						</parameters>
					</function>
				</for>
			</function>
		</public>
	</class>
</starosxml>