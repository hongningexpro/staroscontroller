<?xml version="1.0" encoding="UTF-8"?>
<starosxml xmlns="http://www.staros.xyz/starcore/xml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" scope="application">
<!--
	Author:
			Yi Jian
	Date:
			2017-08-23
	Copyright: 
			Nanjing StarOS Inc. All rights reserved.
-->
	<class name="CSetting">
		<private>
			<variable name="m_component" type="string" />
			<variable name="m_fqComponent" type="string" />
			<variable name="m_prop" type="string" />
			<variable name="m_id" type="string" />
			<variable name="m_type" type="string"/>
			<variable name="m_value" type="string"/>
			<variable name="m_defValue" type="string"/>
			<variable name="m_desc" type="string"/>
		</private>
		<public>
			<function name="CSetting">
				<parameters>
					<parameter name="component" type="string"/>			
					<parameter name="fqComponent" type="string"/>
					<parameter name="prop" type="string"/>			
					<parameter name="id" type="string"/>
					<parameter name="type" type="string"/>	
					<parameter name="value" type="string"/>
					<parameter name="defValue" type="string"/>	
					<parameter name="desc" type="string"/>	
				</parameters>
				<set name="thisclass.m_component" value="context.component.toString()"/>
				<set name="thisclass.m_fqComponent" value="context.fqComponent.toString()"/>
				<set name="thisclass.m_prop" value="context.prop.toString()"/>
				<set name="thisclass.m_id" value="context.id.toString()"/>
				<set name="thisclass.m_type" value="context.type.toString()"/>
				<set name="thisclass.m_value" value="context.value.toString()"/>
				<set name="thisclass.m_defValue" value="context.defValue.toString()"/>
				<set name="thisclass.m_desc" value="context.desc.toString()"/>
			</function>
			<function name="GetSettingJson">
				<parameters>
					<parameter name="outjson" type="string"/>
				</parameters>
				<variable name="values" type="string" />
				<reference variable="values">
					<jsonbody><![CDATA[ 
						{
							"component":"<%=thisclass.m_component.toString()%>",
							"fqComponent":"<%=thisclass.m_fqComponent.toString()%>",
							"prop":"<%=thisclass.m_prop.toString()%>",
							"id":"<%=thisclass.m_id.toString()%>",
							"type":"<%=thisclass.m_type.toString()%>",
							"value":"<%=thisclass.m_value.toString()%>",
							"defValue":"<%=thisclass.m_defValue.toString()%>",
							"desc":"<%=thisclass.m_desc.toString()%>"
						}
					]]></jsonbody>
				</reference>
				<set name="outjson" value="context.values.toString()"/>
			</function>
		</public>
	</class>
	<class name="CSettingsManager">
		<private>
			<container name="settingContainer" type="hashmap" keytype="string" valuetype="class"/>
		</private>
		<public>
			<function name="CSettingsManager">
				<log>CSettingsManager is create</log>
			</function>
			<function name="addSetting">
				<parameters>
					<parameter name="component" type="string"/>			
					<parameter name="fqComponent" type="string"/>
					<parameter name="prop" type="string"/>			
					<parameter name="id" type="string"/>
					<parameter name="type" type="string"/>	
					<parameter name="value" type="string"/>
					<parameter name="defValue" type="string"/>	
					<parameter name="desc" type="string"/>		
				</parameters>
				<variable name="settingobj" type="class" />
				<new name="settingobj" class="CSetting">
					<parameters>
						<parameter name="component" type="string" in="context.component.toString()"/>			
						<parameter name="fqComponent" type="string" in="context.fqComponent.toString()"/>
						<parameter name="prop" type="string" in="context.prop.toString()"/>			
						<parameter name="id" type="string" in="context.id.toString()"/>
						<parameter name="type" type="string" in="context.type.toString()"/>	
						<parameter name="value" type="string" in="context.value.toString()"/>
						<parameter name="defValue" type="string" in="context.defValue.toString()"/>	
						<parameter name="desc" type="string" in="context.desc.toString()"/>		
					</parameters>
				</new>
				<insert name="settingContainer" key="context.id.toString()" value="context.settingobj"/>
			</function>
			<function name="GetAllSettingJson">
				<parameters>
					<parameter name="outjson" type="string"/>
				</parameters>
				<variable name="settingobj" type="class" />
				<container name="jsonlist" type="list" valuetype="string"/>
				<variable name="strjson" type="string" />
				<container name="onesettingContainer" type="pair" keytype="string" valuetype="class"/>
				<for var="onesettingContainer" in="context.settingContainer">
					<function>
						<set name="settingobj" value="context.onesettingContainer.second()"/>
						<function name="GetSettingJson" class="context.settingobj">
							<parameters>
								<parameter name="outjson" type="string" out="context.strjson"/>
							</parameters>
							</function>
						<insert name="jsonlist" value="context.strjson.toString()"/>
					</function>
				</for>
				<script><![CDATA[
					var portsArray=new Array(); 
					var firststring=context.jsonlist.getFirst();
					while(firststring != null)
					{
						//context.print(i);			
						var port = firststring;	
						var info = JSON.parse(port);						
						portsArray.push(info);
						firststring = context.jsonlist.getNext();
					}
					var strjson=JSON.stringify(portsArray);
					context.outjson.setValue(strjson);
				]]></script>
			</function>
		</public>
	</class>
</starosxml>