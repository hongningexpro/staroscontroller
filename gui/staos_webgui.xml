<?xml version="1.0" encoding="UTF-8"?>
<starosxml xmlns="http://www.staros.xyz/starcore" scope="application">
	<define namespace="websocket" name="AcceptWebSocket"/>
	<define namespace="websocket" name="SendText"/>
	<variable name="newSession"/>
	<variable name="nulltest" type="string"/>
	<variable name="systemparam" type="params"/>
	<variable name="isStop" type="boolean" value="true"/>
	<variable name="filepath" type="string"/>
	<variable name="transportid" type="string"/>
	<function name="Restfulserver">
		<variable name="restfulparams" type="params"/>
		<set name="restfulparams" paramname="listenip" value="'0.0.0.0'"/>
		<set name="restfulparams" paramname="listenport" value="'9922'"/>
		<set name="restfulparams" paramname="protocol" value="'http'"/>
		<set name="restfulparams" paramname="cerfile" value="'/opt/staros.xyz/starcore/system/servercert.pem'"/>
		<set name="restfulparams" paramname="keyfile" value="'/opt/staros.xyz/starcore/system/serverkey.pem'"/>
		<log>Restfulserver</log>
		<restful action="SERVER" param="restfulparams" expectevent="restfulrequest.event"/>
	</function>
	<events>
		<onevent event="application.ONSTART">
			<function>
				<script><![CDATA[
					var student = new Object(); 
					student.name = "Lanny"; 
					student.age = "25"; 
					student.location = "China"; 
					var json = JSON.stringify(student); 
					context.nulltest.setValue(json);
					var json = '{"name":"GDT","age":"15","University":"GDUT"}';
					var info = JSON.parse(json);
					context.nulltest.setValue(info.name);
				]]></script>
				<log><![CDATA[ nulltest= <%=context.nulltest.toString()%>]]></log>
				<log>******************************************************************************************</log>
				<log>*</log>
				<log>*  Copyright (C) 2013-2017, Nanjing WFNEX Technology Co., Ltd</log>
				<log>*</log>
				<log>******************************************************************************************</log>
				<function name="Restfulserver"/>
			</function>
		</onevent>
		<onevent event="session.ONSTART">
			<variable name="dbdialog"/>
			<function>
				<log>session.ONSTART</log>
				<!--raise name="application.check"/-->
			</function>
		</onevent>
		<onevent event="test">
			<variable name="dbdialog"/>
			<variable name="testxml" type="long"/>
			<variable name="strname" type="string"/>
			<function>
				<script><![CDATA[var str = '<fu>x</fu>';
					var x = new XML('<root><fu>x2</fu><fu>xssss</fu></root>');
					context.testxml.setValue(x.children().length());
					context.strname.setValue(x.children()[0].toString());
				  ]]></script>
				<log dest="stdout"><![CDATA[SystemInit get a event '<%=context.testxml.toLong()%>']]></log>
				<log dest="stdout"><![CDATA[strname= '<%=context.strname.toString()%>']]></log>
				<log>get event name test</log>
				<application method="LocalEventRequest" event="hellorequest">
					<applicationdata>
						<![CDATA[ 
						hello world;
						]]>
					</applicationdata>
				</application>
				<wait event="hellorequest" timeout="1000"/>
				<log>i am here</log>
				<!--end reason="call. end."/-->
			</function>
		</onevent>
		<onevent event="application.check">
		  <function>
			<log dest="stdout"><![CDATA[get a event '<%=event.getName()%>']]></log>
			<function>
			  <!--raise name="application.check"/-->
			</function>
		  </function>
		</onevent>
		<onevent event="restfulrequest.event">
			<function>
				<set name="filepath" value="'/root/svn/starlang-1.0.2/build/testpage.html'"/>
				<set name="transportid" value="event.getParam('transportid').toString()"/>
				<log dest="stdout"><![CDATA[restfulrequest eventname <%=event.getName()%>]]> </log>
				<log dest="stdout"><![CDATA[restfulrequest transportid '<%=event.getParam("transportid").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest eventdata '<%=event.getParam("eventdata").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest requestpath '<%=event.getParam("requestpath").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest method '<%=event.getParam("method").toString()%>']]></log>
				<websocket method="AcceptWebSocket" transportid="event.getParam('transportid')"/>
			</function>
		</onevent>
		<onevent event="/nav.html">
			<function>
				<set name="filepath" value="'/root/svn/starlang-1.0.2/build/testpage.html'"/>
				<set name="transportid" value="event.getParam('transportid').toString()"/>
				<log dest="stdout"><![CDATA[restfulrequest eventname <%=event.getName()%>]]> </log>
				<log dest="stdout"><![CDATA[restfulrequest transportid '<%=event.getParam("transportid").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest eventdata '<%=event.getParam("eventdata").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest requestpath '<%=event.getParam("requestpath").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest method '<%=event.getParam("method").toString()%>']]></log>
				<restful action="RESPONSE" status="200" text="ok" transportid="event.getParam('transportid')">
					<jsonbody><![CDATA[
						<!-- {INJECTED-VIEW-NAV-START} -->
						<a ng-click="navCtrl.hideNav()" href="#/topo">Network Topology</a>
						<a ng-click="navCtrl.hideNav()" href="#/device">Device List</a>
						<!-- {INJECTED-VIEW-NAV-END} -->
					]]></jsonbody>
				</restful>
			</function>
		</onevent>
		<onevent event="/login.html">
			<function>
				<set name="filepath" value="'/root/svn/starlang-1.0.2/build/testpage.html'"/>
				<set name="transportid" value="event.getParam('transportid').toString()"/>
				<log dest="stdout"><![CDATA[restfulrequest eventname <%=event.getName()%>]]> </log>
				<log dest="stdout"><![CDATA[restfulrequest transportid '<%=event.getParam("transportid").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest eventdata '<%=event.getParam("eventdata").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest requestpath '<%=event.getParam("requestpath").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest method '<%=event.getParam("method").toString()%>']]></log>
				<restful action="RESPONSE" status="200" text="ok" transportid="event.getParam('transportid')">
					<jsonbody><![CDATA[
						<!-- {INJECTED-VIEW-NAV-START} -->
						<a ng-click="navCtrl.hideNav()" href="#/topo">Network Topology</a>
						<a ng-click="navCtrl.hideNav()" href="#/device">Device List</a>
						<!-- {INJECTED-VIEW-NAV-END} -->
					]]></jsonbody>
				</restful>
			</function>
		</onevent>
		<onevent event="restfulrequestssss.event">
			<function>
				<set name="filepath" value="'/root/svn/starlang-1.0.2/build/testpage.html'"/>
				<set name="transportid" value="event.getParam('transportid').toString()"/>
				<log dest="stdout"><![CDATA[restfulrequest eventname <%=event.getName()%>]]> </log>
				<log dest="stdout"><![CDATA[restfulrequest transportid '<%=event.getParam("transportid").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest eventdata '<%=event.getParam("eventdata").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest requestpath '<%=event.getParam("requestpath").toString()%>']]></log>
				<log dest="stdout"><![CDATA[restfulrequest method '<%=event.getParam("method").toString()%>']]></log>
				<restful action="RESPONSE" status="200" text="ok" transportid="event.getParam('transportid')">
					<jsonbody><![CDATA[
							<html>
							<head>
								<meta charset="utf-8">
								<link rel="shortcut icon" href="data/img/onos-logo.png">

								<link rel="apple-touch-icon" href="data/img/apple-touch-icon.png">
								<meta name="apple-mobile-web-app-capable" content="yes">
								<meta name="apple-mobile-web-app-status-bar-style" content="black">
								<meta name="viewport" content="width=device-width, initial-scale=1.0">

								<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700'
									  rel='stylesheet' type='text/css'>

								<title>ONOS</title>

								<!-- Third party library code included here -->
								<!--TODO: use minified versions, once debugging is complete -->
								<script src="tp/angular.js"></script>
								<script src="tp/angular-route.js"></script>
								<script src="tp/angular-cookies.js"></script>

								<script src="tp/d3.js"></script>
								<script src="tp/topojson.v1.min.js"></script>

								<script src="tp/Chart.min.js"></script>
								<script src="tp/angular-chart.min.js"></script>
								<script src="tp/lodash.min.js"></script>

								<!-- {INJECTED-USER-START} -->
								<!-- {INJECTED-USER-END} -->

								<!-- ONOS UI Framework included here -->
								<!-- TODO: use a single catenated-minified file here -->
								<script src="onos.js"></script>
								<script src="app/directives.js"></script>

								<script src="app/fw/util/util.js"></script>
								<script src="app/fw/util/ee.js"></script>
								<script src="app/fw/util/fn.js"></script>
								<script src="app/fw/util/random.js"></script>
								<script src="app/fw/util/theme.js"></script>
								<script src="app/fw/util/keys.js"></script>
								<script src="app/fw/util/prefs.js"></script>

								<script src="app/fw/mast/mast.js"></script>
								<script src="app/fw/nav/nav.js"></script>

								<script src="app/fw/svg/svg.js"></script>
								<script src="app/fw/svg/glyph.js"></script>
								<script src="app/fw/svg/glyphData.js"></script>
								<script src="app/fw/svg/icon.js"></script>
								<script src="app/fw/svg/geodata.js"></script>
								<script src="app/fw/svg/map.js"></script>
								<script src="app/fw/svg/zoom.js"></script>
								<script src="app/fw/svg/svgUtil.js"></script>
								<script src="app/fw/svg/sprite.js"></script>
								<script src="app/fw/svg/spriteData.js"></script>

								<script src="app/fw/remote/remote.js"></script>
								<script src="app/fw/remote/urlfn.js"></script>
								<script src="app/fw/remote/rest.js"></script>
								<script src="app/fw/remote/wsock.js"></script>
								<script src="app/fw/remote/websocket.js"></script>

								<script src="app/fw/widget/widget.js"></script>
								<script src="app/fw/widget/table.js"></script>
								<script src="app/fw/widget/toolbar.js"></script>
								<script src="app/fw/widget/tooltip.js"></script>
								<script src="app/fw/widget/button.js"></script>
								<script src="app/fw/widget/tableDetail.js"></script>
								<script src="app/fw/widget/tableBuilder.js"></script>
								<script src="app/fw/widget/chartBuilder.js"></script>
								<script src="app/fw/widget/listBuilder.js"></script>

								<script src="app/fw/layer/layer.js"></script>
								<script src="app/fw/layer/panel.js"></script>
								<script src="app/fw/layer/dialog.js"></script>
								<script src="app/fw/layer/flash.js"></script>
								<script src="app/fw/layer/quickhelp.js"></script>
								<script src="app/fw/layer/veil.js"></script>
								<script src="app/fw/layer/loading.js"></script>

								<!-- Framework and library stylesheets included here -->
								<!-- TODO: use a single catenated-minified file here -->
								<link rel="stylesheet" href="app/onos.css">
								<link rel="stylesheet" href="app/onos-theme.css">
								<link rel="stylesheet" href="app/common.css">
								<link rel="stylesheet" href="app/fw/mast/mast.css">
								<link rel="stylesheet" href="app/fw/mast/mast-theme.css">
								<link rel="stylesheet" href="app/fw/svg/glyph.css">
								<link rel="stylesheet" href="app/fw/svg/glyph-theme.css">
								<link rel="stylesheet" href="app/fw/svg/sprite-theme.css">
								<link rel="stylesheet" href="app/fw/svg/icon.css">
								<link rel="stylesheet" href="app/fw/svg/icon-theme.css">
								<link rel="stylesheet" href="app/fw/layer/panel.css">
								<link rel="stylesheet" href="app/fw/layer/panel-theme.css">
								<link rel="stylesheet" href="app/fw/layer/dialog.css">
								<link rel="stylesheet" href="app/fw/layer/dialog-theme.css">
								<link rel="stylesheet" href="app/fw/layer/flash.css">
								<link rel="stylesheet" href="app/fw/layer/flash-theme.css">
								<link rel="stylesheet" href="app/fw/layer/quickhelp.css">
								<link rel="stylesheet" href="app/fw/layer/quickhelp-theme.css">
								<link rel="stylesheet" href="app/fw/layer/veil.css">
								<link rel="stylesheet" href="app/fw/layer/veil-theme.css">
								<link rel="stylesheet" href="app/fw/layer/loading.css">
								<link rel="stylesheet" href="app/fw/nav/nav.css">
								<link rel="stylesheet" href="app/fw/nav/nav-theme.css">
								<link rel="stylesheet" href="app/fw/widget/button.css">
								<link rel="stylesheet" href="app/fw/widget/button-theme.css">
								<link rel="stylesheet" href="app/fw/widget/toolbar.css">
								<link rel="stylesheet" href="app/fw/widget/toolbar-theme.css">
								<link rel="stylesheet" href="app/fw/widget/tooltip.css">
								<link rel="stylesheet" href="app/fw/widget/tooltip-theme.css">
								<link rel="stylesheet" href="app/fw/widget/table.css">
								<link rel="stylesheet" href="app/fw/widget/table-theme.css">

								<!-- Under development for Region support. -->
								<script src="app/view/topo2/topo2.js"></script>
								<script src="app/view/topo2/topo2Breadcrumb.js"></script>
								<script src="app/view/topo2/topo2Background.js"></script>
								<script src="app/view/topo2/topo2Badge.js"></script>
								<script src="app/view/topo2/topo2Collection.js"></script>
								<script src="app/view/topo2/topo2DetailsPanel.js"></script>
								<script src="app/view/topo2/topo2Device.js"></script>
								<script src="app/view/topo2/topo2DeviceDetailsPanel.js"></script>
								<script src="app/view/topo2/topo2Event.js"></script>
								<script src="app/view/topo2/topo2Force.js"></script>
								<script src="app/view/topo2/topo2Host.js"></script>
								<script src="app/view/topo2/topo2HostsPanel.js"></script>
								<script src="app/view/topo2/topo2Instance.js"></script>
								<script src="app/view/topo2/topo2KeyCommands.js"></script>
								<script src="app/view/topo2/topo2Label.js"></script>
								<script src="app/view/topo2/topo2LabelCollection.js"></script>
								<script src="app/view/topo2/topo2Layout.js"></script>
								<script src="app/view/topo2/topo2Link.js"></script>
								<script src="app/view/topo2/topo2LinkLabel.js"></script>
								<script src="app/view/topo2/topo2LinkPanel.js"></script>
								<script src="app/view/topo2/topo2Map.js"></script>
								<script src="app/view/topo2/topo2MapConfig.js"></script>
								<script src="app/view/topo2/topo2Mastership.js"></script>
								<script src="app/view/topo2/topo2Model.js"></script>
								<script src="app/view/topo2/topo2NodeModel.js"></script>
								<script src="app/view/topo2/topo2NodePosition.js"></script>
								<script src="app/view/topo2/topo2NoDevicesConnected.js"></script>
								<script src="app/view/topo2/topo2Overlay.js"></script>
								<script src="app/view/topo2/topo2Panel.js"></script>
								<script src="app/view/topo2/topo2PeerRegion.js"></script>
								<script src="app/view/topo2/topo2Prefs.js"></script>
								<script src="app/view/topo2/topo2Region.js"></script>
								<script src="app/view/topo2/topo2RegionNavigation.js"></script>
								<script src="app/view/topo2/topo2Select.js"></script>
								<script src="app/view/topo2/topo2SpriteLayer.js"></script>
								<script src="app/view/topo2/topo2SummaryPanel.js"></script>
								<script src="app/view/topo2/topo2SubRegion.js"></script>
								<script src="app/view/topo2/topo2SubRegionPanel.js"></script>
								<script src="app/view/topo2/topo2Toolbar.js"></script>
								<script src="app/view/topo2/topo2Traffic.js"></script>
								<script src="app/view/topo2/topo2TrafficOverlay.js"></script>
								<script src="app/view/topo2/topo2View.js"></script>
								<script src="app/view/topo2/topo2ViewController.js"></script>
								<script src="app/view/topo2/topo2Zoom.js"></script>
								<script src="app/view/topo2/uiView.js"></script>
								<link rel="stylesheet" href="app/view/topo2/topo2.css">
								<link rel="stylesheet" href="app/view/topo2/topo2-theme.css">

								<!-- Builtin views javascript. -->
								<script src="app/view/topo/topo.js"></script>
								<script src="app/view/topo/topoD3.js"></script>
								<script src="app/view/topo/topoEvent.js"></script>
								<script src="app/view/topo/topoDialog.js"></script>
								<script src="app/view/topo/topoFilter.js"></script>
								<script src="app/view/topo/topoForce.js"></script>
								<script src="app/view/topo/topoInst.js"></script>
								<script src="app/view/topo/topoLink.js"></script>
								<script src="app/view/topo/topoModel.js"></script>
								<script src="app/view/topo/topoOblique.js"></script>
								<script src="app/view/topo/topoOverlay.js"></script>
								<script src="app/view/topo/topoPanel.js"></script>
								<script src="app/view/topo/topoSelect.js"></script>
								<script src="app/view/topo/topoMap.js"></script>
								<script src="app/view/topo/topoSprite.js"></script>
								<script src="app/view/topo/topoTraffic.js"></script>
								<script src="app/view/topo/topoTrafficNew.js"></script>
								<script src="app/view/topo/topoProtectedIntent.js"></script>
								<script src="app/view/topo/topoProtectedIntentOverlay.js"></script>
								<script src="app/view/topo/topoToolbar.js"></script>
								<script src="app/view/device/device.js"></script>
								<script src="app/view/flow/flow.js"></script>
								<script src="app/view/port/port.js"></script>
								<script src="app/view/group/group.js"></script>
								<script src="app/view/meter/meter.js"></script>
								<script src="app/view/partition/partition.js"></script>
								<script src="app/view/link/link.js"></script>
								<script src="app/view/host/host.js"></script>
								<script src="app/view/intent/intent.js"></script>
								<script src="app/view/app/app.js"></script>
								<script src="app/view/settings/settings.js"></script>
								<script src="app/view/cluster/cluster.js"></script>
								<script src="app/view/processor/processor.js"></script>
								<script src="app/view/tunnel/tunnel.js"></script>

								<!-- Contributed javascript injected here -->
								<!-- {INJECTED-JAVASCRIPT-START} -->
								<!-- {INJECTED-JAVASCRIPT-END} -->

								<!-- Builtin views stylesheets. -->
								<link rel="stylesheet" href="app/view/topo/topo.css">
								<link rel="stylesheet" href="app/view/topo/topo-theme.css">
								<link rel="stylesheet" href="app/view/topo/protected-intents.css">
								<link rel="stylesheet" href="app/view/device/device.css">
								<link rel="stylesheet" href="app/view/device/device-theme.css">
								<link rel="stylesheet" href="app/view/flow/flow.css">
								<link rel="stylesheet" href="app/view/flow/flow-theme.css">
								<link rel="stylesheet" href="app/view/port/port.css">
								<link rel="stylesheet" href="app/view/group/group.css">
								<link rel="stylesheet" href="app/view/group/group-theme.css">
								<link rel="stylesheet" href="app/view/meter/meter.css">
								<link rel="stylesheet" href="app/view/meter/meter-theme.css">
								<link rel="stylesheet" href="app/view/partition/partition.css">
								<link rel="stylesheet" href="app/view/link/link.css">
								<link rel="stylesheet" href="app/view/host/host.css">
								<link rel="stylesheet" href="app/view/intent/intent.css">
								<link rel="stylesheet" href="app/view/intent/intent-theme.css">
								<link rel="stylesheet" href="app/view/app/app.css">
								<link rel="stylesheet" href="app/view/app/app-theme.css">
								<link rel="stylesheet" href="app/view/settings/settings.css">
								<link rel="stylesheet" href="app/view/settings/settings-theme.css">
								<link rel="stylesheet" href="app/view/cluster/cluster.css">
								<link rel="stylesheet" href="app/view/processor/processor.css">
								<link rel="stylesheet" href="app/view/tunnel/tunnel.css">

								<!-- Contributed stylesheets injected here -->
								<!-- {INJECTED-STYLESHEETS-START} -->
								<!-- {INJECTED-STYLESHEETS-END} -->

							</head>
							<body class="light" ng-app="onosApp">
							<div id="frame" ng-controller="OnosCtrl as onosCtrl" detect-browser>
								<div id="mast"
									 ng-controller="MastCtrl as mastCtrl"
									 ng-include="'app/fw/mast/mast.html'"></div>

								<div id="view" ng-view></div>

								<div id="nav"
									 ng-controller="NavCtrl as navCtrl"
									 ng-include="'nav.html'"></div>

								<div id="floatpanels"></div>
								<div id="alerts"></div>
								<div id="tooltip"></div>
								<div id="flash"></div>
								<div id="quickhelp"></div>
								<div id="veil">
									<div class="msg"></div>
									<svg resize></svg>
								</div>
							</div>

							<script>
								<!-- Inject user agent info into html element to allow CSS sensitivity. -->
								(function () {
									var t = ('ontouchstart' in window) || ('onmsgesturechange' in window);
									d3.select(document.documentElement)
										.attr('data-useragent', navigator.userAgent)
										.attr('data-platform', navigator.platform)
										.classed('touch', t);
								}());
							</script>
							</body>
							</html>
					]]></jsonbody>
				</restful>
			</function>
		</onevent>
		<onevent event="*">
			<function>
			<log level="1"><![CDATA[ invalid event <%=event.getName()%>]]> </log>
			<log level="1"><![CDATA[ invalid param <%=event.getParam("eventdata").toString()%>]]> </log>
			</function>
		</onevent>
	</events>
</starosxml>